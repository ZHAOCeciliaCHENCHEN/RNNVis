webpackJsonp([1],{11:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){t.forEach(function(t,e){t.color=k.color(e),i(t),o(t)})}function r(t){_.select(t.el).style("fill-opacity",t.opacity).style("font-weight",t.weight).style("stroke","none").style("fill",t.baseColor),t.bound&&(t.bound.remove(),t.bound=null)}function i(t){_.select(t.el).style("fill-opacity",1).style("font-weight",t.weight+300).style("stroke","none").style("fill",t.color),t.bound&&(t.bound.remove(),t.bound=null)}function o(t){var e=t.el.getBBox();t.bound=_.select(t.el.parentNode).insert("path").attr("d","M "+(t.x-e.width/2-1.5)+" "+(t.y+2)+" H "+(t.x+e.width/2+1.5)).style("stroke",t.color)}Object.defineProperty(e,"__esModule",{value:!0}),e.SELECT_SENTENCE_NODE=e.CLOSE_SENTENCE=e.DESELECT_WORD=e.DESELECT_UNIT=e.SELECT_LAYER=e.SELECT_WORD=e.SELECT_UNIT=e.SentenceRecord=e.CoClusterProcessor=e.EVALUATE_SENTENCE=e.CHANGE_LAYOUT=e.SELECT_STATE=e.SELECT_MODEL=e.bus=void 0;var l=a(71),u=n(l),c=a(72),h=n(c),d=a(34),f=n(d),p=a(10),g=n(p),v=a(32),m=n(v),y=a(21),_=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(y),w=a(167),k={selectedModel:null,selectedState:null,selectedLayer:null,selectedModel2:null,selectedState2:null,selectedLayer2:null,layout:{},layout2:{},modelConfigs:{},coClusters:{},availableModels:null,sentenceRecords:{},statistics:{},modelsSet:null,selectedUnits:[],selectedWords:[],selectedUnits2:[],selectedWords2:[],selectedNode:null,selectedNode2:null,compare:!1,color:_.scaleOrdinal(_.schemeCategory10),renderPos:!1,renderPos2:!1},b=new g.default({data:{state:k,cell2states:{GRU:["state"],BasicLSTM:["state_c","state_h"],BasicRNN:["state"]}},computed:{},methods:{loadModelConfig:function(t){return t?Object.prototype.hasOwnProperty.call(k.modelConfigs,t)?f.default.resolve(t):m.default.getModelConfig(t,function(e){200===e.status&&(k.modelConfigs[t]=e.data)}):f.default.reject(t)},loadAvailableModels:function(){var t=this;return null===this.state.availableModels?(console.log("Start loading model data"),m.default.getModels(function(e){if(200===e.status){var a=e.data;t.state.availableModels=a.models,t.state.modelsSet=new h.default(t.state.availableModels)}})):f.default.resolve("Already Loaded")},loadCoCluster:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.selectedModel,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.selectedState,a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{top_k:300,mode:"raw",layer:-1},r=new w.CoClusterProcessor(t,e,n,s),i=w.CoClusterProcessor.identifier(r);return this.state.coClusters.hasOwnProperty(i)?f.default.resolve("Cocluster data already loaded"):this.loadAvailableModels().then(function(){if(a.state.modelsSet.has(t))return r.load();throw"No model named "+t}).then(function(){return a.state.coClusters[i]=r,"Succeed"})},getCoCluster:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.selectedModel,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.selectedState,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{top_k:300,mode:"raw",layer:-1},s=new w.CoClusterProcessor(t,e,a,n),r=w.CoClusterProcessor.identifier(s);if(this.state.coClusters.hasOwnProperty(r))return this.state.coClusters[r];console.log("First call loadCoCluster(...) to load remote Data!")},modelCellType:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.selectedModel;if(k.modelsSet.has(t)){return this.state.modelConfigs[t].model.cell_type}},availableStates:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.selectedModel;if(k.modelsSet.has(t)){var e=this.state.modelConfigs[t];return this.cell2states[e.model.cell_type]}},layerNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedModel;if(k.modelsSet.has(t)){return this.state.modelConfigs[t].model.cells.length}},layerSize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.selectedModel,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(k.modelsSet.has(t)){-1===e&&(e=this.layerNum(t)-1);return this.state.modelConfigs[t].model.cells[e].num_units}},evalSentence:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.selectedModel;k.sentenceRecords.hasOwnProperty(e)||(k.sentenceRecords[e]=[]);var a=new w.SentenceRecord(t,e);return k.sentenceRecords[e].push(a),a},loadStatistics:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.selectedModel,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.selectedState,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;if(!k.modelsSet.has(t))return f.default.reject("No available model "+t);if("state"!==e&&"state_c"!==e&&"state_h"!==e)return f.default.reject("No available state "+e);if(k.statistics.hasOwnProperty(t)||(k.statistics[t]={}),k.statistics[t].hasOwnProperty(e)||(k.statistics[t][e]=[]),-1===a&&(a=this.layerNum(t)-1),k.statistics[t][e][a])return k.statistics[t][e][a].load();var s=new w.StateStatistics(t,e,a,n);return k.statistics[t][e][a]=s,s.load()},getStatistics:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.selectedModel,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.selectedState,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(k.statistics.hasOwnProperty(t)&&k.statistics[t].hasOwnProperty(e)&&k.statistics[t][e][a])return k.statistics[t][e][a];console.log("bus > unable to get statistics for "+t+", "+e+", "+a)},loadPosStatistics:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.selectedModel,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,a=arguments[2];return this.state.modelsSet.has(t)?m.default.getPosStatistics(t,e,a):f.default.reject("No model with name "+t+" available!")}},created:function(){var t=this;this.$on("SELECT_MODEL",function(e,a){a?(t.state.selectedModel2=e,t.state.compare=!!e):t.state.selectedModel=e,console.log("bus > current models : "+k.selectedModel+", "+k.selectedModel2)}),this.$on("SELECT_STATE",function(e,a){a?t.state.selectedState2=e:t.state.selectedState=e,console.log("bus > current states : "+k.selectedState+", "+k.selectedState2)}),this.$on("SELECT_LAYER",function(e,a){a?t.state.selectedLayer2=e:t.state.selectedLayer=e}),this.$on("CHANGE_LAYOUT",function(e,a){a?t.state.layout2=(0,u.default)({},e):t.state.layout=(0,u.default)({},e),console.log("bus > "+(a?"compare":"")+" clusterNum: "+e.clusterNum)}),this.$on("EVALUATE_SENTENCE",function(t,e){console.log("bus > evaluating model "+(e?k.selectedModel2:k.selectedModel)+' on sentence "'+t+'"')}),this.$on("SELECT_UNIT",function(e,a){if(a){var n=t.state.selectedUnits2.slice();n.push(e),n.length>2&&n.splice(0,1),t.state.selectedUnits2=n,t.state.selectedWords2=[],t.state.selectedNode2=null}else{var s=t.state.selectedUnits.slice();s.push(e),s.length>2&&s.splice(0,1),t.state.selectedUnits=s,t.state.compare&&(t.state.selectedWords=[],t.state.selectedNode=null)}console.log("bus > selected unit "+e)}),this.$on("SELECT_WORD",function(e,a){var n=void 0;a?(n=t.state.selectedWords2.slice(),t.state.selectedUnits2=[],t.state.selectedNode2=null):(n=t.state.selectedWords.slice(),t.state.compare&&(t.state.selectedUnits=[],t.state.selectedNode=null)),n.push(e),n.length>3&&(r(n[0]),n.splice(0,1)),s(n),a?t.state.selectedWords2=n:t.state.selectedWords=n,console.log("bus > selected word: "+e.text)}),this.$on("DESELECT_UNIT",function(e,a){if(a){var n=t.state.selectedUnits2.indexOf(e);t.state.selectedUnits2.splice(n,1)}else{var s=t.state.selectedUnits.indexOf(e);t.state.selectedUnits.splice(s,1)}console.log("bus > deselected unit: "+e)}),this.$on("DESELECT_WORD",function(e,a){var n=void 0;n=a?t.state.selectedWords2.slice():t.state.selectedWords.slice();var i=n.findIndex(function(t){return t.text===e.text});console.log("bus > deleted idx: "+i),r(n[i]),n.splice(i,1),s(n),a?t.state.selectedWords2=n:t.state.selectedWords=n,console.log("bus > deselected word: "+e.text)}),this.$on("CLOSE_SENTENCE",function(t,e){console.log("bus > close sentence: "+t)}),this.$on("SELECT_SENTENCE_NODE",function(e,a){a?t.state.selectedNode2=e:t.state.selectedNode=e,console.log("bus > sentence node selected: "+e.word)})}});e.default=b,e.bus=b,e.SELECT_MODEL="SELECT_MODEL",e.SELECT_STATE="SELECT_STATE",e.CHANGE_LAYOUT="CHANGE_LAYOUT",e.EVALUATE_SENTENCE="EVALUATE_SENTENCE",e.CoClusterProcessor=w.CoClusterProcessor,e.SentenceRecord=w.SentenceRecord,e.SELECT_UNIT="SELECT_UNIT",e.SELECT_WORD="SELECT_WORD",e.SELECT_LAYER="SELECT_LAYER",e.DESELECT_UNIT="DESELECT_UNIT",e.DESELECT_WORD="DESELECT_WORD",e.CLOSE_SENTENCE="CLOSE_SENTENCE",e.SELECT_SENTENCE_NODE="SELECT_SENTENCE_NODE"},165:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.BoxArtist=e.AreaArtist=e.LineArtist=e.Chart=void 0;var s=a(324),r=n(s),i=a(329),o=n(i),l=a(328),u=n(l),c=a(33),h=n(c),d=a(25),f=n(d),p=a(26),g=n(p),v=a(21),m=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(v),y=function(){function t(e){(0,f.default)(this,t),this.chart=e,this.handles=[],this.drawHooks=[]}return(0,g.default)(t,[{key:"draw",value:function(){this.drawHooks.forEach(function(t){return t()})}},{key:"clean",value:function(){this.handles.forEach(function(t){t.transition().duration(200).style("opacity",0).remove()}),this.handles=[],this.drawHooks=[]}},{key:"group",get:function(){return this.chart.group}},{key:"scale",get:function(){return this.chart.scale}}]),t}(),_=m.scaleOrdinal(m.schemeCategory10),w=e.Chart=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;(0,f.default)(this,t),this.bggroup=e.append("g"),this.bg=this.bggroup.append("rect").attr("opacity",0),this.group=this.bggroup.append("g"),this.width=a,this.height=n,this.marginAll=[0,0,0,0],this.scale={x:null,y:null},this.extents=[[1/0,-1/0],[1/0,-1/0]],this.axis={x:null,y:null},this.axisHandles={x:null,y:null},this.charts=[],this.artists={},this.drawHooks={xAxis:null,yAxis:null},this.offset=[],this.rotateFlag=!1}return(0,g.default)(t,[{key:"resize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"translate",value:function(t,e){return this.offset=[t,e],this.bggroup.attr("transform","translate("+this.offset[0]+","+this.offset[1]+")"),this}},{key:"transform",value:function(){var t=this;if(!0===this.rotateFlag){this.width,this.marginLeft,this.marginRight,this.height,this.marginTop,this.marginBottom;(0,h.default)(this.artists).forEach(function(e){t.artists[e].handles.forEach(function(e){var a="translate("+-(t.width-t.marginLeft-t.marginRight)+", 0)";e.attr("transform","rotate(-90, 0, 0)"+a)})})}}},{key:"rotate",value:function(){var t=this;if(this.rotateFlag=!this.rotateFlag,this.rotateFlag){this.drawTmp=this.draw;var e=[this.width,this.height],a=this.marginAll;this.draw=function(){t.axisHandles.x=t.axisHandles.y=1,t.width=e[1],t.height=e[0],t.marginAll=[a[1],a[2],a[3],a[0]],t.updateScale(),t.drawTmp(),t.axisHandles.x=t.axisHandles.y=null,t.width=e[0],t.height=e[1],t.marginAll=a,t.extents.reverse(),t.updateScale(),t.drawAxis(),t.extents.reverse()}}else this.draw=this.drawTmp;return this}},{key:"background",value:function(t,e){return this.bg.attr("width",this.width).attr("height",this.height).attr("fill",t).attr("opacity",e),this}},{key:"margin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;return this.marginAll=[t,e,a,n],this.group.attr("transform","translate("+this.marginLeft+", "+this.marginTop+")"),this}},{key:"subChart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=new t(this.group,e,a).translate(this.marginLeft,this.marginTop);return this.charts.push(n),n}},{key:"updateExtentI",value:function(t,e){var a=t[1]-t[0],n=0===a?1e4:10<a?1:Math.round(10/a);return this.extents[e][0]=Math.min(Math.floor(n*(t[0]-.02*a))/n,this.extents[e][0]),this.extents[e][1]=Math.max(Math.ceil(n*(t[1]+.02*a))/n,this.extents[e][1]),this}},{key:"updateExtent",value:function(t,e){return this.updateExtentI(t,0).updateExtentI(e,1)}},{key:"updateScale",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t[0]},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t[1]};return this.updateScaleX(t,e).updateScaleY(t,a)}},{key:"updateScaleX",value:function(t,e){return t&&this.updateExtentI(m.extent(t,e),0),this.scale.x=m.scaleLinear().domain(this.extents[0]).rangeRound([0,this.width-this.marginRight-this.marginLeft]),this}},{key:"updateScaleY",value:function(t,e){return t&&this.updateExtentI(m.extent(t,e),1),this.scale.y=m.scaleLinear().domain(this.extents[1]).rangeRound([this.height-this.marginBottom-this.marginTop,0]),this}},{key:"drawAxis",value:function(){!this.axisHandles.x&&this.drawHooks.xAxis&&this.drawHooks.xAxis(),!this.axisHandles.y&&this.drawHooks.yAxis&&this.drawHooks.yAxis()}},{key:"xAxis",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"x",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",n=void 0;if("bottom"===a)n=function(){return[0,t.scale.y(t.extents[1][0])]},this.axis.x=m.axisBottom();else{if("top"!==a)return console.log("Unknown axis position: "+a),this;n=function(){return[0,t.scale.y(t.extents[1][1])]},this.axis.x=m.axisTop()}return this.drawHooks.xAxis=function(){if(t.axis.x.scale(t.scale.x),t.axisHandles.x=t.group.append("g"),t.axisHandles.x.attr("transform","translate("+n()+")").call(t.axis.x),e){t.axisHandles.x.append("text").attr("transform","translate("+[t.scale.x(t.extents[0][1]),0]+")").attr("dx",6.5).attr("dy",6.5).attr("text-anchor","start").attr("font-size",13).style("fill","#000").text(e)}},this}},{key:"yAxis",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",n=void 0;if("left"===a)n=function(){return[t.scale.x(t.extents[0][0]),0]},this.axis.y=m.axisLeft();else{if("right"!==a)return console.log("Unknown axis position: "+a),this;n=function(){return[t.scale.x(t.extents[0][1]),0]},this.axis.y=m.axisRight()}return this.drawHooks.yAxis=function(){if(t.axis.y.scale(t.scale.y),t.axisHandles.y=t.group.append("g").attr("transform","translate("+n()+")").call(t.axis.y),e){t.axisHandles.y.append("text").attr("transform","translate("+[0,t.scale.y(t.extents[1][1])]+")").attr("dx",0).attr("dy",-6.5).attr("text-anchor","middle").attr("font-size",13).style("fill","#000").text(e)}},this}},{key:"line",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t[0]},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t[1]};this.updateScale(t,e,a);var n=void 0;if(this.artists.lines)n=this.artists.lines;else{n=new k(this),this.artists.lines=n}return n.plot(t,e,a)}},{key:"area",value:function(t,e,a,n,s){this.updateScaleX(t,e).updateScaleY(t,a).updateScaleY(t,n);var r=void 0;if(this.artists.areas)r=this.artists.areas;else{r=new b(this),this.artists.areas=r}return r.plot(t,e,a,n,s)}},{key:"box",value:function(t,e,a,n,s,r){arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.updateScaleX(t,a).updateScaleY(t,function(t,e){return r(t,e)[0]}).updateScaleY(t,function(t,e){return r(t,e)[1]});var i=void 0;if(this.artists.boxes)i=this.artists.boxes;else{i=new x(this),this.artists.boxes=i}return i.plot(t,e,a,n,s,r,{})}},{key:"draw",value:function(){var t=this;this.transform(),(0,h.default)(this.artists).forEach(function(e){return t.artists[e].draw()}),this.charts.forEach(function(t){return t.draw()}),this.drawAxis()}},{key:"clean",value:function(){var t=this;return this.charts.forEach(function(t){return t.clean()}),(0,h.default)(this.artists).forEach(function(e){return t.artists[e].clean()}),(0,h.default)(this.axisHandles).forEach(function(e){t.axisHandles[e]&&(t.axisHandles[e].remove(),t.axisHandles[e]=null)}),this.marginAll=[0,0,0,0],this.rotateFlag=!1,this.scale={x:null,y:null},this.extents=[[1/0,-1/0],[1/0,-1/0]],this.drawHooks={xAxis:null,yAxis:null},this.charts=[],this}},{key:"marginTop",get:function(){return this.marginAll[0]}},{key:"marginRight",get:function(){return this.marginAll[1]}},{key:"marginBottom",get:function(){return this.marginAll[2]}},{key:"marginLeft",get:function(){return this.marginAll[3]}}]),t}(),k=e.LineArtist=function(t){function e(t){(0,f.default)(this,e);var a=(0,o.default)(this,(e.__proto__||(0,r.default)(e)).call(this,t));return a.data=[],a.lines=[],a}return(0,u.default)(e,t),(0,g.default)(e,[{key:"plot",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t[0]},a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t[1]},s=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:_(this.handles.length),this.group.append("path")),r=m.line().x(function(t,n){return a.scale.x(e(t,n))}).y(function(t,e){return a.scale.y(n(t,e))}),i=function(){s.datum(t).attr("d",r).attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round")};return this.data.push(t),this.handles.push(s),this.lines.push(r),this.drawHooks.push(i),s}}]),e}(y),b=e.AreaArtist=function(t){function e(t){(0,f.default)(this,e);var a=(0,o.default)(this,(e.__proto__||(0,r.default)(e)).call(this,t));return a.data=[],a.areas=[],a}return(0,u.default)(e,t),(0,g.default)(e,[{key:"plot",value:function(t,e,a,n){var s=this,r=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:_(this.handles.length),this.group.append("path")),i=m.area().x(function(t,a){return s.scale.x(e(t,a))}).y0(function(t,e){return s.scale.y(a(t,e))}).y1(function(t,e){return s.scale.y(n(t,e))}),o=function(){r.datum(t),r.attr("d",i)};return this.data.push(t),this.handles.push(r),this.areas.push(i),this.drawHooks.push(o),r}}]),e}(y),x=e.BoxArtist=function(t){function e(t){(0,f.default)(this,e);var a=(0,o.default)(this,(e.__proto__||(0,r.default)(e)).call(this,t));return a.data=[],a}return(0,u.default)(e,t),(0,g.default)(e,[{key:"plot",value:function(t,a,n,s,r,i,o){var l=this,u=this.group.append("g"),c=function(){t.forEach(function(t,o){var c=l.scale.x(n(t,o));e.drawBox(u,[c-a/2,c+a/2],l.scale.y(s(t,o)),r(t,o).map(function(t){return l.scale.y(t)}),i(t,o).map(function(t){return l.scale.y(t)}))})};return this.handles.push(u),this.drawHooks.push(c),this.data.push(t),u}}],[{key:"drawBox",value:function(t,e,a,n,s){var r=t.append("g"),i=(e[0]+e[1])/2;r.append("rect").attr("x",e[0]).attr("y",Math.min(n[0],n[1])).attr("width",e[1]-e[0]).attr("height",Math.abs(n[1]-n[0])),r.append("line").attr("x1",e[0]).attr("y1",a).attr("x2",e[1]).attr("y2",a).attr("stroke-width",.5);for(var o=0;o<2;o+=1)r.append("line").attr("x1",i).attr("y1",n[o]).attr("x2",i).attr("y2",s[o]).attr("stroke-width",.5),r.append("line").attr("x1",e[0]).attr("y1",s[o]).attr("x2",e[1]).attr("y2",s[o]).attr("stroke-width",.5);return r}}]),e}(y);e.default={Chart:w}},166:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new y(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.sentence=void 0;var r=a(168),i=n(r),o=a(50),l=n(o),u=a(73),c=n(u),h=a(25),d=n(h),f=a(26),p=n(f),g=a(21),v=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(g),m=(a(167),{nodeIntervalScale:1.5,color:v.scaleOrdinal(v.schemeCategory20),radiusScale:1.5,widthScale:1.5,avgValueRange:[-.5,.5],rulerScale:.2,markerWidthScale:.6,markerHeightScale:.3,wordSize:12,labelSize:10,negColor:"#09adff",posColor:"#ff5b09"}),y=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;(0,d.default)(this,t),this.group=e,this._size=[50,600],this._rectSize=[20,50],this._sentence,this._coCluster,this.params=n,this._dataList=[],this.type="bar2",this.compare=a,this._mouseoverCallback=function(t){console.log(t)},this._barMouseoverCallback=function(t){console.log(t)},this.transform()}return(0,p.default)(t,[{key:"mouseoverCallback",value:function(t){return arguments.length?(this._mouseoverCallback=t,this):this._mouseoverCallback}},{key:"barMouseoverCallback",value:function(t){return arguments.length?(this._barMouseoverCallback=t,this):this._barMouseoverCallback}},{key:"size",value:function(t){return arguments.length?(this._size=t,this):this._size}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.compare&&(t+="scale(-1, 1) translate("+[-this.nodeWidth,0]+")"),console.log(t),this.group.transition().duration(200).attr("transform",t),this}},{key:"sentence",value:function(t){return arguments.length?(this._sentence=t,this):this._sentence}},{key:"coCluster",value:function(t){return arguments.length?(this._coCluster=t,this):this._coCluster}},{key:"words",value:function(t){return arguments.length?(this._words=t,this):this._words}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.type;return this.type=e,this.prepareDraw(e),"pie"===e?this._dataList.forEach(function(e,a){var n=t.getWordPos(a),s=t.group.append("g");t.drawWord(s,e,a).attr("transform","translate("+n+")")}):this._dataList.forEach(function(e,a){var n=t.getWordPos(a);if(a>0){var s=t.group.append("g");t.drawConnection(s,e,a).attr("transform","translate("+[n[0],n[1]-t.nodeInterval]+")")}var r=t.group.append("g");t.drawWord(r,e,a).attr("transform","translate("+n+")")}),this}},{key:"drawWordRect",value:function(t,e,a,n){return e.forEach(function(e,n){t.append("text").text(e.word).style("text-anchor","middle").attr("transform","rotate(90)translate("+[a[1]*n+a[1]/2,-a[0]/4]+")"),t.append("rect").attr("x",0).attr("y",n*a[1]).attr("width",a[0]).attr("height",a[1]).attr("fill","lightgray").attr("stroke-width",2).attr("stroke","blue").attr("opacity",.2)}),t.append("g").call(v.brushY().extent([[0,0],[a[0],a[1]*e.length]]).on("end",function(){if(v.event.sourceEvent&&v.event.selection){var t=v.event.selection;t[0]=Math.round(t[0]/a[1])*a[1],t[1]=Math.round(t[1]/a[1])*a[1],v.select(this).transition().call(v.event.target.move,t),n([Math.round(t[0]/a[1]),Math.round(t[1]/a[1])])}})),t}},{key:"prepareDraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.type;this._dataList.length!==this._sentence.length||this._dataList[0].data[0].current.length!=this._coCluster.labels.length?this._dataList=this.preprocess(this._sentence,this._coCluster,this._words):this.clean();var e=.1;if(this.dataList.forEach(function(t){t.data.forEach(function(t){var a=t.currents[0]-Math.min(t.updateds[0],0),n=t.currents[1]-Math.min(t.updateds[1],0),s=Math.max(a/t.size,Math.abs(n/t.size));e=e<s?s:e})}),e=Math.ceil(11*e)/10,this.params.avgValueRange=[-e,e],"bar"===t){this.scaleHeight=v.scaleLinear().range([-this.nodeHeight/2,this.nodeHeight/2]).domain(this.params.avgValueRange);for(var a=0,n=0;n<this._dataList[0].data.length;n++)a+=this._dataList[0].data[n].size;this.scaleWidth=v.scaleLinear().range([0,this.nodeWidth]).domain([0,a])}else"bar2"===t&&(this.scaleHeight=v.scaleLinear().range([-this.nodeHeight/2,this.nodeHeight/2]).domain(this.params.avgValueRange));this.drawWord="pie"===t?this.drawOneWordPie:"bar"===t?this.drawOneWordBar:this.drawOneWordBar2,this.drawConnection="bar"===t?this.drawOneConnection:"bar2"===t?this.drawOneConnection2:null}},{key:"clean",value:function(){this._dataList.forEach(function(t){t.el&&t.el.transition().duration(300).style("opacity",0).remove()})}},{key:"destroy",value:function(){this.clean(),this._dataList=[]}},{key:"getWordPos",value:function(t){return[0,(this.nodeHeight+this.nodeInterval)*t]}},{key:"drawOneWordBar",value:function(t,e,a){var n=this.nodeHeight,s=this.nodeWidth,r=this.params.color;console.log(e);var i=this.scaleHeight,o=this.scaleWidth,l=(t.append("rect").attr("x",0).attr("y",0).attr("width",s).attr("height",n).attr("stroke","gray").attr("stroke-width",.5).attr("fill","none"),t.selectAll("g").data(e.data)),u=l.enter().append("g");u.append("rect").attr("x",function(t){return o(t.accumulate)}).attr("y",function(t){return n-i(t.prev/t.size)}).attr("width",function(t){return o(t.size)}).attr("height",function(t){return i(t.prev/t.size)}).attr("fill",function(t,e){return r(e)});u.style("fill-opacity",.4).style("stroke","gray").style("stroke-width",.5);var c=l.enter().append("g");c.append("rect").attr("x",function(t){return o(t.accumulate)}).attr("y",function(t){return n-i(t.updated*t.major<0?t.prev/t.size:(t.prev+t.updated*t.major)/t.size)}).attr("width",function(t){return o(t.size)}).attr("height",function(t){return i(Math.abs(t.updated)/t.size)}).attr("fill",function(t,e){return t.updated*t.major<0?"white":r(e)});return c.style("fill-opacity",.8).style("stroke","gray").style("stroke-width",.5),e.el=t,t}},{key:"drawOneWordBar2",value:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this,r=this.nodeHeight,i=this.nodeWidth,o=this.params.color,l=this.scaleHeight,u=this.nodeWidth/e.data.length,c=this.params.posColor,h=this.params.negColor;t.on("mouseover",function(){s._mouseoverCallback(e,a,!0)}).on("mouseleave",function(){s._mouseoverCallback(e,a,!1)}).on("click",function(){s._mouseoverCallback(e,a,!1,!0)});var d=t.append("rect").attr("x",0).attr("y",0).attr("width",i).attr("height",r).attr("stroke","black").attr("stroke-width",1).attr("stroke-opacity",.3).attr("fill","white").attr("fill-opacity",0),f=t.selectAll("g").data(e.data),p=f.enter().append("g").on("mouseenter",function(t,e){s._barMouseoverCallback(e,!0)}).on("mouseleave",function(t,e){s._barMouseoverCallback(e,!1)}),g=p.append("rect").attr("x",function(t,e){return u*e}).attr("y",function(t){return r/2-l(t.currents[0]/t.size)}).attr("width",function(t){return u}).attr("height",function(t){return l((t.currents[0]-t.currents[1])/t.size)}).attr("fill",function(t,e){return o(e)});p.style("fill-opacity",.4).attr("stroke","black").attr("stroke-width",1).attr("stroke-opacity",.5),p.append("path").attr("d",function(t,e){return"M "+u*e+" "+(r/2-l(t.currents[0]/t.size))+" H "+u*(e+1)}).attr("stroke-width",2),p.append("path").attr("d",function(t,e){return"M "+u*e+" "+(r/2-l(t.currents[1]/t.size))+" H "+u*(e+1)}).attr("stroke-width",2);var v=f.enter().append("g"),m=v.append("rect").attr("x",function(t,e){return u*e}).attr("y",function(t){return r/2+l(-t.currents[1]/t.size)}).attr("width",function(t){return u}).attr("height",function(t){return l(Math.abs(t.updateds[1])/t.size)}).attr("transform",function(t){return t.updateds[1]<0?"translate("+[0,-l(Math.abs(t.updateds[1])/t.size)]+")":""}).style("fill-opacity",.4);n?m.attr("fill",function(t,e){return t.updateds[1]>0?"none":o(e)}):(m.attr("fill",function(t,e){return t.updateds[1]>0?c:h}),g.attr("fill",function(t,e){return"#bbb"})),v.style("stroke-width",.5).style("stroke","none");var y=f.enter().append("g"),_=y.append("rect").attr("x",function(t,e){return u*e}).attr("y",function(t){return r/2-l(t.currents[0]/t.size)}).attr("width",function(t){return u}).attr("height",function(t){return l(Math.abs(t.updateds[0])/t.size)}).attr("transform",function(t){return t.updateds[0]<0?"translate("+[0,-l(Math.abs(t.updateds[0])/t.size)]+")":""}).style("stroke-opacity",function(t,e){return t.updateds[1],1});n?_.attr("fill",function(t,e){return t.updateds[0]<0?"none":o(e)}):_.attr("fill",function(t,e){return t.updateds[0]<0?h:c}),y.style("stroke-width",.5).style("stroke","none").style("fill-opacity",.4),t.append("path").attr("d","M0 "+r/2+" H "+i).style("stroke","black").style("stroke-width",.5);var w=this.params.wordSize,k=this.params.labelSize,b=[this.params.avgValueRange[1],this.params.avgValueRange[0]],x=this.compare?4+i:-2-w;return t.selectAll("text").data(b).enter().append("text").attr("x",this.compare?i+2:-2).attr("y",function(t,e){return e*(r-4)+5}).attr("text-anchor",this.compare?"start":"end").attr("font-size",k).text(function(t){return t}),t.append("text").attr("x",x).attr("y",r/2).attr("text-anchor","middle").attr("transform","rotate("+[90,x,r/2]+")").attr("font-size",w).text(e.word),g.each(function(t){t.els?t.els[0]=this:t.els=[this]}),m.each(function(t){t.els[1]=this}),_.each(function(t){t.els[2]=this}),e.els=[g,m,_],e.el=t,e.bg=d,t}},{key:"drawOneConnection2",value:function(t,e,a){var n=this,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.nodeInterval,i=s?this.params.color:function(t){return e.data[t].currents[0]+e.data[t].currents[1]>0?n.params.posColor:n.params.negColor},o=this.nodeWidth/e.data.length,l=this.params.rulerScale*o,u=this.params.markerWidthScale*o,c=this.params.markerHeightScale*o,h=t.selectAll("g").data(e.data).enter().append("g");h.append("rect").attr("x",function(t,e){return o*(e+.5)-l/2}).attr("y",0).attr("width",l).attr("height",function(t){return(r-c)*t.keptRate}).style("stroke","none").style("fill",function(t,e){return i(e)}).style("fill-opacity",.5),h.append("rect").attr("x",function(t,e){return o*(e+.5)-l/2}).attr("y",function(t){return(r-c)*t.keptRate}).attr("width",l).attr("height",function(t){return r-(r-c)*t.keptRate}).style("stroke","none").style("fill","gray").style("fill-opacity",.5),h.append("path").attr("d",function(t,e){return"M"+(o*(e+.5)-u/2)+" "+(r-c)*t.keptRate+" H "+(o*(e+.5)+u/2)+" L "+o*(e+.5)+" "+((r-c)*t.keptRate+c)});return t}},{key:"drawOneConnection",value:function(t,e,a){var n=this.nodeInterval,s=(this.nodeWidth,this.params.color);console.log(e);var r=this.scaleWidth,i=function(t){var e=new Array(4),a=(1-t.keptRate)*t.size/2;return e[0]=[r(t.accumulate),0],e[1]=[r(t.accumulate+t.size),0],e[2]=[r(t.accumulate+t.size-a),n],e[3]=[r(t.accumulate+a),n],e[0]+" "+e[1]+" "+e[2]+" "+e[3]};return t.selectAll("polygon").data(e.data).enter().append("polygon").attr("points",function(t){return i(t)}).attr("fill",function(t,e){return s(e)}).attr("fill-opacity",.6),t}},{key:"drawOneWordPie",value:function(t,e,a){var n=this.radius,s=this.params.color;console.log(e);for(var r=v.arc().innerRadius(1).outerRadius(function(t){return n*t.data.keptRate}),i=v.arc().innerRadius(function(t){return n*t.data.keptRate}).outerRadius(n),o=v.arc().innerRadius(function(t){return n*(t.data.updatedRate<0?1+t.data.updatedRate:1)}).outerRadius(function(t){return n*(t.data.updatedRate<0?1:1+t.data.updatedRate)}),l=[r,o,i],u=v.pie().sort(null).value(function(t){return t.prev?t.prev:t.current}),c=new Array(3),h=new Array(3),d=0;d<3;d++){(function(n){if(c[n]=t.append("g"),0===a&&0===n)return"continue";h[n]=c[n].selectAll(".arc").append("g").classed("arc",!0).data(u(e.data)).enter().append("path").attr("d",l[n]).attr("stroke","gray").attr("stroke-width",.3).attr("fill",function(t,e){return 2===n?"gray":s(e)})})(d)}return h[1].attr("fill-opacity",function(t,a){return e.data[a].updatedRate<0?.3:.7}),c[0].attr("fill-opacity",.7),c[2].attr("fill-opacity",0),e.els=c,e.handles=h,e.el=t,t}},{key:"preprocess",value:function(t,e,a){for(var n=t.length,s=e.labels.length,r=(t[0].length,e.colClusters.map(function(t){return t.length})),o=new Float32Array(r.length),u=1;u<o.length;u++)o[u]+=o[u-1]+r[u-1];for(var h=t.map(function(t){return e.colClusters.map(function(e){return e.map(function(e){return t[e]})})}),d=t.map(function(e,a){return 0===a?e:e.map(function(e,n){return e-t[a-1][n]})}),f=new Array(n),p=new Array(n),g=new Array(n),v=0;v<n;v++){f[v]=new Float32Array(s),p[v]=new Float32Array(s),g[v]=new Float32Array(s);for(var m=0;m<s;m++)for(var y=0;y<r[m];y++)h[v][m][y]>0?f[v][m]+=h[v][m][y]:p[v][m]+=h[v][m][y],g[v][m]+=Math.abs(h[v][m][y])}for(var _=[new Float32Array(s)].concat((0,c.default)(g.slice(0,n-1))),w=[h[0].map(function(t){return new Float32Array(t.length)})].concat((0,c.default)(h)),k=new Array(n),b=new Array(n),x=new Array(n),C=0;C<n;C++){k[C]=new Float32Array(s),b[C]=new Float32Array(s),x[C]=new Float32Array(s);for(var S=0;S<s;S++)for(var E=0;E<r[S];E++){var M=w[C][S][E],L=w[C+1][S][E],N=L/M;k[C][S]+=Math.abs(M)*(N<0?0:1<N?1:N),b[C][S]+=M>0&&L>0?L>M?M:L:0,x[C][S]+=M<0&&L<0?L<M?M:L:0}}return a.map(function(t,e){return{word:t,data:(0,l.default)(g[e],function(t,a){var n=_[e][a],s=b[e][a],l=x[e][a],u=s-l,c=f[e][a],h=p[e][a],d=e>0?f[e-1][a]:0,g=e>0?p[e-1][a]:0,v=c-d,m=h-g,y=v+m;r[a];return{currents:[c,h],current:t,prev:n,updatedRate:0===n?0:y/n,keptRate:0===n?0:u/n,updated:y,updateds:[v,m],kepts:[s,l],kept:u,size:r[a],accumulate:o[a],major:(0,i.default)(c+h)}}),response:d[e]}})}},{key:"radius",get:function(){if(!this._radius){var t=this._size[0]/(2*this.params.widthScale);if(!this._sentence||this._radius)return t;var e=this._size[1]/(this.params.nodeIntervalScale*(this._sentence.length-1)+2*this.params.radiusScale*this._sentence.length);this._radius=t<e?t:e}return this._radius}},{key:"nodeHeight",get:function(){return 2*this.params.radiusScale*this.radius}},{key:"nodeWidth",get:function(){return 2*this.params.widthScale*this.radius}},{key:"nodeInterval",get:function(){return this.params.nodeIntervalScale*this.radius}},{key:"dataList",get:function(){return this._dataList}},{key:"strengthByCluster",get:function(){if(this._sentence&&this._coCluster)return this._dataList.length===this._sentence.length&&this._dataList[0].data[0].current.length==this._coCluster.labels.length||(this._dataList=this.preprocess(this._sentence,this._coCluster,this._words)),this._strengthByCluster||(this._strengthByCluster=this._dataList.map(function(t,e){return t.data.map(function(t,e){return 0===t.size?0:t.updated/t.size})})),this._strengthByCluster}}]),t}();e.sentence=s},167:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){var e={};return function(){var t=arguments.length+Array.prototype.join.call(arguments,",");return t in e?e[t]:e[t]=f.apply(this,arguments)}}Object.defineProperty(e,"__esModule",{value:!0}),e.StateStatistics=e.SentenceRecord=e.CoClusterProcessor=void 0;var r=a(34),i=n(r),o=a(33),l=n(o),u=a(72),c=n(u),h=a(73),d=n(h),p=a(50),g=n(p),v=a(25),m=n(v),y=a(26),_=n(y),w=a(32),k=n(w),b=e.CoClusterProcessor=function(){function t(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{top_k:300,mode:"raw",layer:-1},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"col";(0,m.default)(this,t),this.rawData,this._rowClusters,this._colClusters,this._colSizes,this._rolSizes,this._aggregation_info=null,this.modelName=e,this.stateName=a,this.nCluster=n,this.params=s,this.sortBy=r}return(0,_.default)(t,[{key:"load",value:function(){var t=this;return k.default.getCoCluster(this.modelName,this.stateName,this.nCluster,this.params,function(e){if(200!==e.status)throw e;t.rawData=e.data,console.log(t)})}},{key:"strength_filter",value:function(t){switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.mode){case"positive":return t>0?t:0;case"negative":return t<0?Math.abs(t):0;case"abs":return Math.abs(t);case"raw":return t}}},{key:"Create2DArray",value:function(t,e){return(0,g.default)({length:t},function(t,a){return new Float32Array(e)})}},{key:"correlation",get:function(){return this.hasData?this.rawData.data:void 0}},{key:"labels",get:function(){var t=this;return this.hasData&&!this._labels&&(this._labels=[].concat((0,d.default)(new c.default([].concat((0,d.default)(this.colLabels),(0,d.default)(this.rowLabels))))),"col"===this.sortBy?this._labels.sort(function(e,a){return t.colSizes[e]-t.colSizes[a]}):"row"===this.sortBy&&this._labels.sort(function(e,a){return t.rowSizes[e]-t.rowSizes[a]})),this._labels}},{key:"colSizes",get:function(){if(this.hasData&&!this._colSizes){var t=new Int32Array(this.labels.length);this.colLabels.forEach(function(e,a){t[e]+=1}),this._colSizes=t}return this._colSizes}},{key:"rowSizes",get:function(){if(this.hasData&&!this._rowSizes){var t=new Int32Array(this.labels.length);this.rowLabels.forEach(function(e,a){t[e]+=1}),this._rowSizes=t}return this._rowSizes}},{key:"rowLabels",get:function(){return this.hasData?this.rawData.row:void 0}},{key:"colLabels",get:function(){return this.hasData?this.rawData.col:void 0}},{key:"ids",get:function(){return this.hasData?this.rawData.ids:void 0}},{key:"words",get:function(){return this.hasData?this.rawData.words:void 0}},{key:"hasData",get:function(){return Boolean(this.rawData)}},{key:"aggregation_info",get:function(){var t=this;if(this.hasData&&!this._aggregation_info){var e=this.Create2DArray(this.nCluster,this.nCluster),a=this.Create2DArray(this.rawData.row.length,this.nCluster),n=this.Create2DArray(this.nCluster,this.rawData.col.length),s=this.Create2DArray(this.rawData.row.length,this.rawData.col.length);this.correlation.forEach(function(r,i){r.forEach(function(r,o){var l=t.strength_filter(r);e[t.rawData.row[i]][t.rawData.col[o]]+=l/(t.rowSizes[t.rowLabels[i]]*t.colSizes[t.colLabels[o]]),n[t.rawData.row[i]][o]+=l/t.rowSizes[t.rowLabels[i]],a[i][t.rawData.col[o]]+=l/t.colSizes[t.colLabels[o]],s[i][o]+=l})}),this._aggregation_info={row_cluster_2_col_cluster:e,row_single_2_col_cluster:a,row_cluster_2_col_single:n,row_single_2_col_single:s}}return this._aggregation_info}},{key:"cluster2cluster",get:function(){var t=this;if(this.hasData&&!this._cluster2cluster){var e=this.Create2DArray(this.nCluster,this.nCluster);this.correlation.forEach(function(a,n){a.forEach(function(a,s){var r=t.strength_filter(a);e[t.rawData.row[n]][t.rawData.col[s]]+=r})}),this._cluster2cluster=e}return this._cluster2cluster}},{key:"single2cluster",get:function(){var t=this;if(this.hasData&&!this._single2cluster){var e=this.Create2DArray(this.rawData.row.length,this.nCluster);this.correlation.forEach(function(a,n){a.forEach(function(a,s){var r=t.strength_filter(a);e[n][t.rawData.col[s]]+=r})}),this._single2cluster=e}return this._cluster2cluster}},{key:"cluster2single",get:function(){var t=this;if(this.hasData&&!this._cluster2single){var e=this.Create2DArray(this.nCluster,this.rawData.col.length);this.correlation.forEach(function(e,a){e.forEach(function(e,n){var s=t.strength_filter(e);row_single_2_col_single[a][n]+=s})}),this._cluster2single=e}return this._cluster2single}},{key:"single2single",get:function(){var t=this;if(this.hasData&&!this._single2single){this.Create2DArray(this.rawData.row.length,this.rawData.col.length);this.correlation.forEach(function(e,a){e.forEach(function(e,n){var s=t.strength_filter(e);row_single_2_col_cluster[a][t.rawData.col[n]]+=s})}),this._single2cluster=row_single_2_col_cluster}return this._cluster2cluster}},{key:"rowClusters",get:function(){var t=this;if(this.hasData&&!this._rowClusters){var e=(0,g.default)({length:this.labels.length},function(t,e){return[]});this.rawData.row.forEach(function(t,a){e[t].push(a)}),this._rowClusters=new Array(this.labels.length),this.labels.forEach(function(a,n){return t._rowClusters[n]=e[a]})}return this._rowClusters}},{key:"colClusters",get:function(){var t=this;if(this.hasData&&!this._colClusters){var e=(0,g.default)({length:this.labels.length},function(t,e){return[]});this.rawData.col.forEach(function(t,a){void 0===e[t]&&(e[t]=[]),e[t].push(a)}),this._colClusters=new Array(this.labels.length),this.labels.forEach(function(a,n){return t._colClusters[n]=e[a]})}return this._colClusters}}],[{key:"identifier",value:function(t){return""+t.modelName+t.stateName+t.nCluster+(t.params.layer+1)}}]),t}(),x=e.SentenceRecord=function(){function t(e,a){(0,m.default)(this,t),this.inputs=e,this.tokens,this.records,this.modelName=a}return(0,_.default)(t,[{key:"evaluate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.modelName;return k.default.getTextEvaluation(e,this.inputs,function(e){if(200!==e.status)throw e;var a=e.data;t.tokens=a.tokens[0],t.records=a.records[0]})}},{key:"getRecords",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(this.records)return e=-1===e?this.layerNum-1:e,console.log(e),this.records.map(function(a){return a[t][e]})}},{key:"states",get:function(){return this.records&&!this._states&&(this._states=(0,l.default)(this.records[0])),this._states}},{key:"layerNum",get:function(){return this.records&&!this._layerNum&&(this._layerNum=this.records[0][this.states[0]].length),this._layerNum}}]),t}(),C=e.StateStatistics=function(){function t(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;(0,m.default)(this,t),this.modelName=e,this.stateName=a,this.layer=n,this.top_k=s,this.data}return(0,_.default)(t,[{key:"load",value:function(){var t=this;return this.data?i.default.resolve("Already loaded"):k.default.getStateStatistics(this.modelName,this.stateName,this.layer,this.top_k,function(e){t.data=e.data})}},{key:"statOfWord",value:function(t){if(this.data){var e=this.word2Id[t];return this.wordsData[e]}}},{key:"stateNum",get:function(){return this.data?this.data.mean[0].length:void 0}},{key:"statesData",get:function(){var t=this;return this.data&&!this._statesData&&(this._statesData=this.data.mean[0].map(function(e,a){return{words:t.data.words,mean:t.data.mean.map(function(t){return t[a]}),low1:t.data.low1.map(function(t){return t[a]}),low2:t.data.low2.map(function(t){return t[a]}),high1:t.data.high1.map(function(t){return t[a]}),high2:t.data.high2.map(function(t){return t[a]}),rank:t.data.sort_idx.map(function(t){return t.findIndex(function(t){return t===a})})}})),this._statesData}},{key:"word2Id",get:function(){if(this.data&&!this._word2Id){var t={};this.data.words.forEach(function(e,a){t[e]=a}),this._word2Id=t}return this._word2Id}},{key:"wordsData",get:function(){var t=this;return this.data&&!this._wordsData&&(this._wordsData=this.data.mean.map(function(e,a){return{mean:e,range1:t.data.low1[a].map(function(e,n){return[e,t.data.high1[a][n]]}),range2:t.data.low2[a].map(function(e,n){return[e,t.data.high2[a][n]]}),word:t.data.words[a],sort_idx:t.data.sort_idx[a]}})),this._wordsData}}]),t}();e.default={CoClusterProcessor:b,SentenceRecord:x,StateStatistics:C,memorize:s}},280:function(t,e,a){a(698);var n=a(12)(a(312),a(723),null,null);t.exports=n.exports},282:function(t,e){},283:function(t,e,a){a(700);var n=a(12)(a(309),a(725),null,null);t.exports=n.exports},307:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){for(var e=new Float32Array(t[0].length),a=0;a<e.length;a++){for(var n=0,s=0;s<t.length;s++)n+=t[s][a];e[a]=n/t.length}return e}function r(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"euclidean",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new f(n).cluster(t,e,a,s)}Object.defineProperty(e,"__esModule",{value:!0}),e.kMeans=e.distances=void 0;var i=a(321),o=n(i),l=a(25),u=n(l),c=a(26),h=n(c);e.kmeans=r;var d=e.distances={euclidean:function(t,e){for(var a=0,n=0;n<t.length;n++)a+=Math.pow(e[n]-t[n],2);return Math.sqrt(a)},manhattan:function(t,e){for(var a=0,n=0;n<t.length;n++)a+=Math.abs(e[n]-t[n]);return a},max:function(t,e){for(var a=0,n=0;n<t.length;n++)a=Math.max(a,Math.abs(e[n]-t[n]));return a}},f=e.kMeans=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean";(0,u.default)(this,t),this.centroids=e||[],this.distance=a,"string"==typeof this.distance&&(this.distance=d[this.distance])}return(0,h.default)(t,[{key:"randomCentroids",value:function(t,e){var a=t.slice(0);return a.sort(function(){return Math.round(Math.random())-.5}),a.slice(0,e)}},{key:"classify",value:function(t){for(var e=1/0,a=0,n=0;n<this.centroids.length;n++){var s=this.distance(t,this.centroids[n]);s<e&&(e=s,a=n)}return a}},{key:"cluster",value:function(t,e,a,n){var r=this;e=e||Math.max(2,Math.ceil(Math.sqrt(t.length/2))),a=a||100,this.centroids=this.randomCentroids(t,e);for(var i=new Int32Array(t.length),o=new Array(e),l=0,u=!0;u&&l<a;){for(var c=0;c<t.length;c++)i[c]=this.classify(t[c]);u=!1;for(var h=0;h<e;h++){(function(e){var a=t.filter(function(t,a){return i[a]==e});if(!a.length)return"continue";for(var n=r.centroids[e],l=new s(a),c=0;c<n.length;c++)l[c]!=n[c]&&(u=!0);r.centroids[e]=l,o[e]=a})(h)}l++,n&&n(o,l)}return l>=a&&console.log("Clustering algorithm early stopped."),i}},{key:"toJSON",value:function(){return(0,o.default)(this.centroids)}},{key:"fromJSON",value:function(){return this.centroids=JSON.parse(json),this}}]),t}()},308:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var s=a(10),r=n(s),i=a(281),o=n(i);a(282);var l=a(283),u=n(l);r.default.use(o.default),new r.default({el:"#app",render:function(t){return t(u.default)}})},309:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(716),r=n(s),i=a(714),o=n(i),l=a(720),u=n(l),c=a(713),h=n(c),d=a(280),f=n(d),p=a(11);e.default={name:"app",components:{ModelView:r.default,MainView:o.default,TextView:u.default,InfoView:h.default,InfoBoard:f.default},data:function(){return{height:800,width:1e3,shared:p.bus.state}},computed:{mainHeight:function(){return this.compare?.6*this.height:.9*this.height},infoHeight:function(){return.2*this.height},compare:function(){return this.shared.compare}},mounted:function(){var t=this;this.height=window.innerHeight,this.width=window.innerWidth,window.addEventListener("resize",function(){t.height=window.innerHeight,t.width=window.innerWidth})}}},310:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(33),r=n(s),i=a(25),o=n(i),l=a(26),u=n(l),c=a(34),h=n(c),d=a(21),f=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(d),p=a(32),g=n(p),v=a(11),m=a(97);e.default={name:"ArcView",data:function(){return{states:"",fdGraph:null,selectedState:"",model:"",wordNum:200,clusterNum:5,cluster_data:{},state_data:null,word_data:null,cluster_mode:"positive"}},props:{width:{type:Number,default:800},height:{type:Number,default:600}},watch:{width:function(t){this.fdGraph.update_scale()},height:function(t){this.fdGraph.update_scale()},selectedState:function(t){var e=this;if(!("state"!==t&&"state_c"!==t&&"state_h"!==t||null!==this.word_data&&null!==this.state_data)){var a=this.loadStateWordData(),n=this.loadClusterData();a.push(n),h.default.all(a).then(function(t){e.reset()})}},wordNum:function(t){console.log("wordNum has changed")},clusterNum:function(t){var e=this;t>1&&this.loadClusterData().then(function(t){e.reset()})}},computed:{svgId:function(){return this.paneId(this.model,this.selectedState)}},methods:{paneId:function(t,e){return"arc-"+t+"-"+e+"-svg"},loadStateWordData:function(){var t=this;return[g.default.getProjectionData(this.model,this.selectedState,{},function(e){t.state_data=e.data,console.log("state data loaded")}),g.default.getStrengthData(this.model,this.selectedState,{top_k:this.wordNum},function(e){t.word_data=e.data,console.log("word data loaded")})]},loadClusterData:function(){var t=this;return v.bus.loadCoCluster(this.model,this.selectedState,this.clusterNum,{top_k:this.wordNum,mode:this.cluster_mode}).then(function(){t.cluster_data=v.bus.getCoCluster(t.model,t.selectedState,t.clusterNum,{top_k:t.wordNum,mode:t.cluster_mode}),console.log("co_cluster_data "+t.clusterNum+" loaded")})},reset:function(){this.fdGraph&&this.fdGraph.destroy();var t=document.getElementById(this.paneId(this.model,this.selectedState));this.fdGraph=new y(t),this.fdGraph.process_data(this.state_data,this.word_data,this.cluster_data,this.cluster_mode),this.fdGraph.insert_element(),this.fdGraph.start_simulation()}},mounted:function(){var t=this;v.bus.$on(v.SELECT_MODEL,function(e,a){a||(console.log("Selected model in ArcView: "+e),t.model=e,v.bus.loadModelConfig(e).then(function(){t.states=v.bus.availableStates(e)}))})}};var y=function(){function t(e,a){(0,o.default)(this,t);var n=this;this.svg=f.select("#"+e.id),this.width=e.clientWidth,this.height=e.clientHeight,this.arcNodes=null,this.innerNodes=null,this.links=null,this.word_clouds=[],this.simulation=null,this.strengthfn=a||function(t){return t},this.graph=null,this.rScale=.1,this.radius=1.5,this.defaultAlpha=.3,this.scale={x:null,y:null},this.color=f.scaleOrdinal(f.schemeCategory20),this.strength_threshold=.5,this.normal_opacity_line=.1,this.high_opacity_line=.1,this.low_opacity_line=.01,this.normal_opacity_node=.5,this.high_opacity_node=1,this.low_opacity_node=.01,this.strength_range=[.1,5],this.arc_radius=.9*Math.min(n.width/2,n.height/2),this.cluster_data=[],this.g_links=null}return(0,u.default)(t,[{key:"process_data",value:function(t,e,a,n){var s=this,i=[],o=[];Math.min(s.width/2,s.height/2);this.cluster_data=a,i=a.colClusters.map(function(t,e){return{data:t.map(function(t){return{index:t,label:e}})}}),o=a.rowClusters.map(function(t,e){return{data:t.map(function(t){return{index:t,label:e,word:a.words[t]}})}});var l=[];console.log(a),(0,r.default)(o).forEach(function(t){o[t].type="inner",(0,r.default)(i).forEach(function(e){i[e].type="arc";var s=0;o[t].data.forEach(function(t){i[e].data.forEach(function(e){var r=a.correlation[t.index][e.index];switch(n){case"positive":s+=r>0?r:0;break;case"negative":s+=r<0?Math.abs(r):0;break;case"abs":s+=Math.abs(r);break;case"raw":s+=r}})});var r={source:i[e],target:o[t],strength:s};l.push(r)})}),l=s.strength_normalize(l,s.strength_range),console.log("finished preparing data"),this.graph={links:l,label2arc:i,label2inner:o,arc_data:t,inner_data:e,nodes:i.concat(o)}}},{key:"strength_normalize",value:function(t,e){var a=f.extent(t.map(function(t){return t.strength}));console.log(a);var n=f.scaleLinear().domain(a).range(e);return t.forEach(function(t){t.strength=n(t.strength)}),t}},{key:"draw_states",value:function(){var t=this,e=this.width,a=this.height,n=.9*Math.min(e/2,a/2);this.svg.append("g").selectAll("circle").data(this.graph.states).enter().append("circle").attr("r",3).attr("cx",function(t){return e/2+n*Math.cos(t.angle)}).attr("cy",function(t){return a/2+n*Math.sin(t.angle)}).style("fill",function(e){return t.color(e.label)})}},{key:"insert_element",value:function(){var t=this,e=this,a=e.svg.append("g").attr("transform","translate("+e.width/2+","+e.height/2+")"),n=f.arc().innerRadius(e.arc_radius-10).outerRadius(e.arc_radius),s=f.pie()(e.graph.label2arc.map(function(t){return t.data.length}));e.graph.label2arc.forEach(function(t,r){a.append("path").datum(s[r]).style("fill",e.color(r)).attr("d",n);var i=n.centroid(s[r]);t.fx=i[0]+e.width/2,t.fy=i[1]+e.height/2});e.graph.label2inner.forEach(function(a){var n=a.data.map(function(t){return{text:t.word,size:(300-t.index)/15}}),s=10*Math.sqrt(n.length)+1;console.log(n),a.el_wc=t.svg.append("g"),new m.WordCloud(a.el_wc,s).update(n),e.word_clouds.push(a.el_wc)})}},{key:"start_simulation",value:function(){var t=this,e=f.forceCollide(20).radius(function(t){return 10*Math.sqrt(t.data.length)+10}),a=e.initialize;e.initialize=function(t){a(t.filter(function(t){return"inner"===t.type}))},this.simulation=f.forceSimulation().alpha(this.defaultAlpha).force("link",f.forceLink().distance(function(t){return t.strength>0?50/t.strength:300}).strength(function(t){return 1})).force("repel",e),this.simulation.nodes(t.graph.nodes).on("tick",function(){return t.ticked()}),this.simulation.force("link").links(t.graph.links)}},{key:"ticked",value:function(){var t=this;t.graph.label2inner.forEach(function(t){t.el_wc.attr("transform","translate("+t.x+","+t.y+")")});var e=f.line().curve(f.curveBundle.beta(1)).x(function(t){return t.x}).y(function(t){return t.y}),a=[],n=[];t.graph.label2arc.forEach(function(e,a){t.graph.label2inner.forEach(function(e){void 0===n[a]&&(n[a]={x:0,y:0}),n[a].x=n[a].x+e.x/t.graph.label2inner.length,n[a].y=n[a].y+e.y/t.graph.label2inner.length})}),t.graph.label2arc.forEach(function(e,s){t.graph.label2inner.forEach(function(t){a.push([e,n[s],t])})}),t.g_links&&t.g_links.remove(),t.g_links=this.svg.append("g"),t.g_links.selectAll("path").data(a).enter().append("path").attr("class","links").attr("d",e).attr("stroke",t.color(0))}},{key:"destroy",value:function(){console.log("Destroying Graph"),this.simulation.nodes([]),this.simulation.force("link").links([]),this.g_links.remove(),this.word_clouds.forEach(function(t){t.remove()})}}]),t}()},311:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(72),r=n(s),i=a(73),o=n(i),l=a(34),u=n(l),c=a(33),h=n(c),d=a(25),f=n(d),p=a(26),g=n(p),v=a(21),m=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(v),y=a(11),_=a(97),w=a(166),k=["#33a02c","#1f78b4","#b15928","#fb9a99","#e31a1c","#6a3d9a","#ff7f00","#cab2d6","#ffff99","#a6cee3","#b2df8a","#fdbf6f"],b=function(t){return k[t]},x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800;(0,f.default)(this,t),this.unitWidthRatio=1,this.unitMarginRatio=.5,this.clusterMarginRatio=.7,this.wordCloudArcDegree=110,this.wordCloudHightlightRatio=1.5,this.wordCloudPaddingLength=5,this.wordCloudChord2ClusterDistance=50,this.wordCloudChordLength2ClientHeightRatio=.8,this.wordCloudChord2stateClusterHeightRatio=1.1,this.wordCloudWidth2HeightRatio=2,this.littleTriangleWidth=5,this.littleTriangleHeight=5,this.strengthThresholdPercent=[.2,1],this.wordSize2StrengthRatio=3,this.dxShrinkFactor=.04,this.spacePerSentence=.1,this.sentenceNodeWidth=100,this.sentenceInitTranslate=[50,10],this.middleLineY=50,this.brushTranslationX=-100,this.sentenceWordThreshold=.5,this.posColor=b,this.middleLineOffset=0,this.width=e,this.height=a,this.sentenceBrushRectWidth=10,this.mode="width"}return(0,g.default)(t,[{key:"updateWidth",value:function(t){"number"==typeof t&&(this.width=Math.min(Math.max(500,t),1400))}},{key:"updateHeight",value:function(t){"number"==typeof t&&(this.height=Math.min(Math.max(200,t),1e3))}},{key:"computeUnitParams",value:function(){}},{key:"computeParams",value:function(t,e,a){var n=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(s>10)){var r=a.reduce(function(t,e){return Math.max(t,e)},0),i=a.reduce(function(t,e){return t+e},0);this._unitHeight=3+this.width/i/3,this.wordCloudChordLength=this.height*this.wordCloudChordLength2ClientHeightRatio,this.clusterHeight=this.wordCloudChordLength/(t+t*e-e),this.packNum=~~((this.clusterHeight/this.unitHeight+this.unitMarginRatio-2*this.clusterMarginRatio)/(1+this.unitMarginRatio)),this.clusterHeight=this.unitHeight*this.cluster2UnitRatio,this.clusterInterval=this.clusterHeight*e,this.middleLineY<0&&this.computeParams(t,e-.2,a,s+1);var o=Math.ceil(r/this.packNum)*(this.unitWidth+this.unitMargin);if(o<.8*this.maxClusterWidth&&(e+=.2,this.computeParams(t,e,a,s+1)),o>this.maxClusterWidth&&(e-=.2,this.computeParams(t,e,a,s+1)),!(s>0))if("height"===this.mode)this.middleLineY=(this.height-this.clusterHeight*t-this.clusterInterval*(t-1))/2;else{this.widthPackNum=~~(this.width/5.5/(this.unitWidth+this.unitMargin)),this.clusterWidth=this.widthPackNum*(this.unitWidth+this.unitMargin)-this.unitMargin+2*this.clusterMargin;var l=0;a.forEach(function(t,e){var a=Math.ceil(t/n.widthPackNum);l+=a*(n.unitHeight+n.unitMargin)-n.unitMargin+2*n.clusterMargin});this.clusterInterval=Math.floor((this.height-l)/(t+2)),this.middleLineY=(this.height-l-t*this.clusterInterval)/2}}}},{key:"wordCloudWidth",get:function(){return.18*this.width}},{key:"unitHeight",get:function(){return this._unitHeight?this._unitHeight:Math.max(3,Math.min(4+~~((this.width-500)/500),7))}},{key:"unitWidth",get:function(){return this.unitHeight*this.unitWidthRatio}},{key:"unitMargin",get:function(){return this.unitHeight*this.unitMarginRatio}},{key:"clusterMargin",get:function(){return this.unitHeight*this.clusterMarginRatio}},{key:"maxClusterWidth",get:function(){return Math.min(this.width/3.5,400)}},{key:"middleLineX",get:function(){return.25*this.width+this.middleLineOffset}},{key:"cluster2UnitRatio",get:function(){return this.packNum+(this.packNum-1)*this.unitMarginRatio+2*this.clusterMarginRatio}}]),t}(),C={VERB:0,NOUN:1,PRON:2,ADJ:3,ADV:4,ADP:5,CONJ:6,DET:7,NUM:8,PRT:9,X:10,".":11},S={colorScheme:b,radius:4,fontSize:11,interval:8};e.default={name:"ClusterView",data:function(){return{params:new x(this.width,this.height),clusterData:null,painter:null,shared:y.bus.state,changingFlag:!1,posLabel:null,rootGroup:null}},props:{compare:{type:Boolean,defautl:!1},width:{type:Number,default:800},height:{type:Number,default:800}},computed:{svgId:function(){return this.compare?"cluster-svg2":"cluster-svg"},selectedState:function(){return this.compare?this.shared.selectedState2:this.shared.selectedState},selectedModel:function(){return this.compare?this.shared.selectedModel2:this.shared.selectedModel},selectedLayer:function(){return this.compare?this.shared.selectedLayer2:this.shared.selectedLayer},layout:function(){return this.compare?this.shared.layout2:this.shared.layout},clusterNum:function(){return this.layout.clusterNum},strokeControlStrength:function(){return this.layout.strokeControlStrength},linkFilterThreshold:function(){return this.layout.linkFilterThreshold},stateClip:function(){return this.layout.stateClip},selectedWords:function(){return this.compare?this.shared.selectedWords2:this.shared.selectedWords},selectedUnits:function(){return this.compare?this.shared.selectedUnits2:this.shared.selectedUnits},renderPos:function(){return this.compare?this.shared.renderPos2:this.shared.renderPos},mode:function(){return this.layout.mode}},watch:{selectedState:function(t){console.log(this.svgId+" > state changed to "+this.selectedState),this.maybeReload()},selectedLayer:function(t){console.log(this.svgId+" > layer changed to "+this.selectedLayer),this.maybeReload()},strokeControlStrength:function(t){this.changeStroke(this.strokeControlStrength,this.linkFilterThreshold)},linkFilterThreshold:function(t){this.changeStroke(this.strokeControlStrength,this.linkFilterThreshold)},clusterNum:function(t){console.log(this.svgId+" > layout changed. clusterNum: "+this.layout.clusterNum),this.maybeReload()},stateClip:function(t){console.log("state clip changed"),this.painter.changeStateClip(t)},mode:function(t){this.params.mode=t,this.maybeReload()},selectedModel:function(t,e){console.log(this.svgId+" > model changed to "+this.selectedModel),this.maybeReload()},selectedWords:function(t){var e=this;if(0===t.length)return void this.painter.render_state([]);var a=this.selectedModel,n=this.selectedState,s=this.selectedLayer;y.bus.loadStatistics(a,n,s).then(function(){var t=y.bus.getStatistics(a,n,s),r=t.statOfWord(e.selectedWords[e.selectedWords.length-1].text).mean;e.painter.render_state(r)})},renderPos:function(t){var e=this,a={};t?y.bus.loadPosStatistics(this.selectedModel,void 0,function(t){if(200===t.status){t.data.forEach(function(t,e){var n=(0,h.default)(t.ratio).map(function(e,a){return{index:a,pos:e,value:t.ratio[e]}});n.sort(function(t,e){return e.value-t.value}),a[t.word]=C[n[0].pos]}),e.posLabel.draw(C).transform("translate("+[e.width-40,10]+")")}e.painter.renderWord(a)}):(this.painter.renderWord(a),this.posLabel.clean())},width:function(t,e){this.params.updateWidth(t),this.maybeReload()},height:function(t){this.params.updateHeight(t),this.maybeReload()}},methods:{checkLegality:function(){var t=this.selectedState;return("state"===t||"state_c"===t||"state_h"===t)&&"number"==typeof this.selectedLayer&&this.layout&&this.painter&&"number"==typeof this.width&&"number"==typeof this.height},maybeReload:function(){var t=this;this.changingFlag||(this.changingFlag=!0,this.checkLegality()?(console.log(this.svgId+" > reloading..."),this.reload(this.selectedModel,this.selectedState,this.selectedLayer,this.clusterNum).then(function(){t.changingFlag=!1})):this.changingFlag=!1)},init:function(){this.params.updateWidth(this.width),this.rootGroup=m.select("#"+this.svgId).append("g"),this.painter=new M(this.rootGroup,this.params,this.compare),this.posLabel=new E(this.rootGroup.append("g"),S,this.compare)},reload:function(t,e,a,n){var s=this,r={top_k:300,mode:"raw",layer:a};return this.renderPos&&(this.posLabel.clean(),this.posLabel.draw(C).transform("translate("+[this.width-40,10]+")")),y.bus.loadCoCluster(t,e,n,r).then(function(){s.clusterData=y.bus.getCoCluster(t,e,n,r),console.log(s.clusterData.colClusters.length),s.rootGroup.attr("transform",s.compare?"scale(-1,1)translate("+[-s.width,0]+")":""),s.painter.destroy(),s.painter.draw(s.clusterData)})},changeStroke:function(t,e){this.painter.refreshStroke(t,e)}},mounted:function(){var t=this;this.init(),y.bus.$on(y.EVALUATE_SENTENCE,function(e,a){if(a===t.compare){var n=y.bus.evalSentence(e,t.selectedModel),s=n.evaluate();u.default.all([s]).then(function(a){var s=n.getRecords(t.selectedState,-1);t.painter.addSentence(e,n,s)})}}),y.bus.$on(y.CLOSE_SENTENCE,function(e,a){a===t.compare&&t.painter.deleteSentence(e)}),y.bus.$on(y.SELECT_COLOR,function(e){console.log("color has changed to "+e),m.select("#"+t.svgId).selectAll(".link.positive").style("stroke",e[1]),m.select("#"+t.svgId).selectAll(".link.negative").style("stroke",e[0])})}};var E=function(){function t(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:False;(0,f.default)(this,t),this.g=e,this.params=a,this.compare=n}return(0,g.default)(t,[{key:"draw",value:function(t){var e=this.params,a=e.colorScheme,n=e.fontSize,s=e.radius,r=e.interval,i=[];(0,h.default)(t).forEach(function(e){i[t[e]]=e});var o=this.g.selectAll("g").data(i).enter().append("g");return o.append("circle").attr("cx",0).attr("cy",function(t,e){return e*(r+2*s)}).attr("r",s).style("fill",function(t,e){return a(e)}),o.append("text").attr("x",2*s).attr("y",function(t,e){return e*(r+2*s)+n/2}).attr("text-anchor","start").style("font-size",n).text(function(t){return t}),this}},{key:"transform",value:function(t){return this.compare&&(t+="scale(-1, 1)"),this.g.attr("transform",t),this}},{key:"clean",value:function(){this.g.selectAll("g").remove()}}]),t}(),M=function(){function t(e,a){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,f.default)(this,t),this.svg=e,this.params=a,this.topGroupClass="topGroup",this.topg=this.svg.append("g").attr("class",this.topGroupClass),this.hg=this.topg.append("g"),this.wg=this.topg.append("g"),this.sentenceWordThreshold=a.sentenceWordThreshold,this.strengthThresholdPercent=a.strengthThresholdPercent,this.dx=0,this.dy=0,this.graph=null,this.clusterSelected=[],this.state_elements=[],this.loc=null,this.wordClouds=[],this.unitNormalColor="#ff5b09",this.unitRangeColor=["#09adff","#ff5b09"],this.linkWidthRange=[1,5],this.linkColor=["#09adff","#ff5b09"],this.compare=n,this.stateTranslateHis=[],this.sentenceTranslateHis=[this.params.sentenceInitTranslate[0]],this.sentences=[],this.stateClip=2,this.strokeWidth=function(t){return 8*Math.abs(t)},this.sentenceStrokeWidth=function(t){return 24*Math.abs(t)},this.colorLegendAxis=null}return(0,g.default)(t,[{key:"transform",value:function(t){this.svg.attr("transform",t)}},{key:"refreshStroke",value:function(t,e){var a=this;this.strokeWidth=function(e){return Math.abs(e)*t},this.sentenceStrokeWidth=function(e){return Math.abs(e)*t/3},this.strengthThresholdPercent=e,this.graph&&(this.draw_link(this.hg,this.graph),this.graph.sentence_info.forEach(function(t){var e=m.extent(a.flatten(t.links).map(function(t){return t.strength})),n=Math.max(Math.abs(e[0]),Math.abs(e[1])),s=a.strengthThresholdPercent.map(function(t){return t*n});t.links.forEach(function(t){t.forEach(function(t){t.el.attr("display",Math.abs(t.strength)<s[0]||Math.abs(t.strength)>s[1]?"none":"").attr("stroke-width",a.sentenceStrokeWidth(t.strength))})})}))}},{key:"changeStateClip",value:function(t){if(this.graph){this.stateClip=t;var e=m.scaleLinear().domain([-this.stateClip,0,this.stateClip]).range([1,0,1]);m.select(this.graph.state_info.state_info[0].el).property("colored")&&(this.graph.state_info.state_info.forEach(function(t,a){var n=m.select(t.el);n.transition().attr("fill",n.property("strength")>0?"#ff5b09":"#09adff").attr("fill-opacity",e(Math.abs(n.property("strength"))))}),this.axisScale.domain([-this.stateClip,this.stateClip]),this.colorLegendAxis=m.axisBottom().tickValues([parseInt(-this.stateClip),0,parseInt(this.stateClip)]).tickFormat(m.format("."+m.precisionFixed(1)+"f")).scale(this.axisScale),this.hg.select("#color-legend").select("g").call(this.colorLegendAxis))}}},{key:"deleteSentence",value:function(t){var e=this,a=this.sentences.filter(function(e){return e!==t});this.sentences=[],this.translateX(-m.sum(this.stateTranslateHis)),this.adjustdx(this.stateClusterWordCloudDX),this.stateTranslateHis=[],this.sentenceTranslateHis=[this.params.sentenceInitTranslate[0]];var n={};this.graph.sentence_info.forEach(function(t){n[t.value]=t,t.group.remove()}),this.graph.sentence_info=[],a.forEach(function(t){e.addSentence(t,n[t].record,n[t].sentenceRecord)})}},{key:"deleteAllSentences",value:function(){this.sentences=[],this.translateX(-m.sum(this.stateTranslateHis)),this.adjustdx(this.stateClusterWordCloudDX),this.stateTranslateHis=[],this.sentenceTranslateHis=[this.params.sentenceInitTranslate[0]];var t={};this.graph.sentence_info.forEach(function(e){t[e.value]=e,e.group.remove()}),this.graph.sentence_info=[]}},{key:"addSentence",value:function(t,e,a){function n(t){var a,n=(a=e.tokens).slice.apply(a,(0,o.default)(t)),s=l.client_height/n.length/l.params.sentenceNodeWidth/1.05;s=Math.min(s,1.5);var r=(l.client_height,(v.getWordPos(t[0])[1]+v.getWordPos(t[1])[1])/2);v.transform("scale("+s+")translate("+[0,-r+l.client_height/2/s]+")"),_.forEach(function(t){t.forEach(function(t){var e=(t.source_init.y-r)*s+l.client_height/2;console.log("client height is "+l.client_height),console.log("actualY is "+e),t.source.x=t.source_init.x*s,t.source.y=e,t.el.transition().attr("d",e>0&&e<l.client_height?l.createLink(t):"")})})}function s(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_[e].forEach(function(t){n&&t.el.attr("hold","false"===t.el.attr("hold")?"true":"false"),"true"!==t.el.attr("hold")?t.el.classed("active",a).attr("display",a||l.sentences.length<2&&"none"!==t.el.attr("display")?"":"none"):t.el.classed("active",!0).attr("display","")}),n&&(t.selected=!t.selected,y.bus.$emit(y.SELECT_SENTENCE_NODE,t,l.compare)),t.bg.classed("active",!!t.selected||a)}function r(t,e){console.log("state "+t+" is hover on or out"),l.update_ref(m.select(l.graph.state_info.state_cluster_info[t].el).select("rect").node(),e?"plus":"minus")}var i=this,l=this,u=(this.params.spacePerSentence+this.params.dxShrinkFactor)*this.client_width,c=u,h=.5*u,d=this.params.sentenceInitTranslate;this.stateTranslateHis.push(h),this.sentences.length&&this.sentenceTranslateHis.push(c);var f=this.svg.append("g").attr("transform","translate("+d[0]+", "+d[1]+")");this.sentences.push(t);var p=f.append("g");this.translateX(m.sum(this.stateTranslateHis)),this.adjustdx(this.stateClusterWordCloudDX),this.graph.sentence_info.forEach(function(t,e){t.group.transition().attr("transform","translate("+[m.sum(i.sentenceTranslateHis),d[1]]+")")});var g=f.append("g").attr("transform","translate("+[-this.params.sentenceNodeWidth/2,this.client_height/4]+")");this.drawBrushRect(g,a.length,n);var v=(0,w.sentence)(p,this.compare).size([this.params.sentenceNodeWidth,this.params.sentenceNodeWidth*a.length]).sentence(a).coCluster(this.graph.coCluster).words(e.tokens).mouseoverCallback(s).barMouseoverCallback(r).draw(),_=[];v.strengthByCluster;v.strengthByCluster.forEach(function(t,e){_[e]=[];var a=v.getWordPos(e);i.graph.coCluster.colClusters.forEach(function(n,s){var r=t[s],o=i.graph.state_info.state_cluster_info[s];_[e][s]={source:{x:a[0]+v.nodeWidth,y:a[1]+v.nodeHeight/2},source_init:{x:a[0]+v.nodeWidth,y:a[1]+v.nodeHeight/2},target:{x:o.top_left[0]+i.middle_line_x-d[0],y:o.top_left[1]+i.middle_line_y+o.height/2-d[1]},strength:r}})});var k=m.extent(this.flatten(_).map(function(t){return t.strength})),b=Math.max(Math.abs(k[0]),Math.abs(k[1])),x=this.strengthThresholdPercent.map(function(t){return t*b}),C=f.append("g");_.forEach(function(t){t.forEach(function(t){t.el=C.append("path").classed("active",!1).classed("link",!0).classed(t.strength>0?"positive":"negative",!0).attr("d",l.createLink(t)).attr("stroke-width",l.sentenceStrokeWidth(t.strength)).attr("opacity",.2).attr("fill","none").attr("display",Math.abs(t.strength)<x[0]||Math.abs(t.strength)>x[1]?"none":"").attr("hold","false")})}),l.graph.sentence_info.push({sentence:v,links:_,value:t,group:f,record:e,sentenceRecord:a}),this.sentences.length>1&&l.graph.sentence_info.forEach(function(t){t.links.forEach(function(t){t.forEach(function(t){t.el.attr("display","none")})})})}},{key:"drawBrushRect",value:function(t,e,a){var n=this,s=this.params.height/2,r=Math.min(s/e,50);console.log("unitHeight is "+r);var i=[n.params.sentenceBrushRectWidth,r];console.log("rect size is "+i);t.selectAll(".wordRect").data(m.range(e)).enter().append("rect").attr("x",0).attr("y",function(t){return t*i[1]}).attr("width",i[0]).attr("height",i[1]).attr("fill","black").attr("stroke-width",1).attr("stroke","blue").attr("opacity",.2);var o=m.brushY().extent([[0,0],[i[0],i[1]*e]]).on("end",function(){if(m.event.sourceEvent&&m.event.selection){var t=m.event.selection,e=Math.round(t[0]/i[1]),n=Math.round(t[1]/i[1]);t[0]=e*i[1],t[1]=n*i[1],m.select(this).transition().call(m.event.target.move,t),console.log(m.event.selection),a([e,n])}});t.append("g").call(o).call(o.move,[0,i[1]*e])}},{key:"calculate_state_info",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"height",a=[],n=[],s=this.params.clusterHeight,r=this.params.packNum;this.params.computeUnitParams();var i=this.params.unitHeight,o=this.params.unitWidth,l=this.params.unitMargin,u=this.params.clusterMargin,c=this.params.clusterInterval,h=t.colClusters;if("height"===e)h.forEach(function(t,e){var h=Math.ceil(t.length/r)*(o+l)-l+2*u,d=s,f=[-h/2,e*(d+c)];n[e]={top_left:f,width:h,height:d},t.forEach(function(t,e){var n=o,s=i,c=[~~(e/r)*(l+o)+u,e%r*(i+l)+u];a[t]={top_left:c,width:n,height:s}})});else if("width"===e){var d=this.params.clusterWidth,f=this.params.widthPackNum,p=0;h.forEach(function(t,e){var s=Math.ceil(t.length/f)*(i+l)-l+2*u,r=[-d/2,p];p+=s+c,n[e]={top_left:r,width:d,height:s},t.forEach(function(t,e){var n=o,s=i,r=[e%f*(l+o)+u,~~(e/f)*(i+l)+u];a[t]={top_left:r,width:n,height:s}})})}return{state_cluster_info:n,state_info:a}}},{key:"calculate_word_info",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this,s=this.params.wordCloudPaddingLength,i=this.params.wordSize2StrengthRatio,o=this.params.wordCloudWidth,l=t.rowClusters,u=t.words,c=t.labels.length,h=t.aggregation_info,d=this.params.wordCloudChordLength,f=d-c*s,p=d/2/Math.sin(this.params.wordCloudArcDegree/2*Math.PI/180);this.params.wordCloudArcRadius=p;var g=[];a>=0&&n.graph.link_info[a].forEach(function(t,e){"none"!==m.select(t.el).attr("display")&&g.push(e)}),g=new r.default(g);var v=[],y=l.map(function(t,a){return 0===g.size?Math.sqrt(t.length):g.has(a)?Math.sqrt(t.length)*e.params.wordCloudHightlightRatio:Math.sqrt(t.length)}),_=y.reduce(function(t,e){return t+e},0),w=(y.reduce(function(t,e){return Math.max(t,e)},0),-d/2);return l.forEach(function(t,e){var a=y[e]/_*f,r=o,l=w,c=Math.sqrt(Math.pow(p,2)-Math.pow(l,2));if(w+=a+s,n.graph&&n.graph.word_info)n.graph.word_info[e].top_left=[c,l],n.graph.word_info[e].width=r,n.graph.word_info[e].height=a,v[e]=n.graph.word_info[e];else{var d=t.map(function(t){return{text:u[t],size:h.row_single_2_col_cluster[t][e]*i}});v[e]={top_left:[c,l],width:r,height:a,words_data:d}}}),v}},{key:"calculate_link_info",value:function(t,e,a,n,s){var r=this,i=this,o=[],l=a.aggregation_info.row_cluster_2_col_cluster,u=(a.colClusters,a.rowClusters,a.labels);return t.state_cluster_info.forEach(function(t,a){e.forEach(function(e,c){if(void 0===o[a]&&(o[a]=[]),r.graph&&r.graph.link_info)o[a][c]={source:{x:t.top_left[0]+t.width,y:t.top_left[1]+t.height/2},target:{x:e.top_left[0]+n,y:e.top_left[1]+e.height/2+s},strength:i.graph.link_info[a][c].strength,el:i.graph.link_info[a][c].el};else{var h=l[u[c]][u[a]];o[a][c]={source:{x:t.top_left[0]+t.width,y:t.top_left[1]+t.height/2},target:{x:e.top_left[0]+n,y:e.top_left[1]+e.height/2+s},strength:h}}})}),o}},{key:"ArcLength2Angle",value:function(t,e){return t/e*180/Math.PI}},{key:"render_state",value:function(t){var e=this;if(t.length){if(!this.hg.select("#color-legend").node()){var a=this.graph.state_info.state_cluster_info[this.graph.state_info.state_cluster_info.length-1],n=this.hg.append("g").attr("id","color-legend").attr("transform","translate("+[0,a.top_left[1]+a.height+.6*this.params.clusterInterval]+")"+(this.compare?"scale(-1, 1)":"")),s=a.width;n.append("rect").attr("transform","translate("+[-s/2,0]+")").transition().attr("x",0).attr("y",0).attr("width",s).attr("height",7.6).style("fill","url(#state-legend)"),this.axisScale=m.scaleLinear().range([0,s]).domain([-this.stateClip,this.stateClip]),this.colorLegendAxis=m.axisBottom().tickValues([parseInt(-this.stateClip),0,parseInt(this.stateClip)]).tickFormat(m.format("."+m.precisionFixed(1)+"f")).scale(this.axisScale),n.append("g").classed("axis",!0).attr("transform","translate("+[-s/2,0]+")").call(this.colorLegendAxis)}var r=m.scaleLinear().domain([-this.stateClip,0,this.stateClip]).range([1,0,1]);this.graph.state_info.state_info.forEach(function(e,a){m.select(e.el).property("colored",!0).property("strength",t[a]).transition().duration(300).attr("fill",t[a]>0?"#ff5b09":"#09adff").attr("fill-opacity",r(Math.abs(t[a])))})}else this.hg.select("#color-legend").remove(),this.graph.state_info.state_info.forEach(function(t,a){m.select(t.el).property("colored",!1).transition().duration(400).attr("fill",e.unitNormalColor).attr("fill-opacity",.3)})}},{key:"renderWord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.graph.word_info.forEach(function(e,a){e.words_data.forEach(function(e,a){e.type=t[e.text]})}),this.draw_word(this.wg,this.graph)}},{key:"redraw_word_link",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.graph.word_info=this.calculate_word_info(this.graph.coCluster,t),this.graph.link_info=this.calculate_link_info(this.graph.state_info,this.graph.word_info,this.graph.coCluster,this.stateClusterWordCloudDX,this.dy),this.draw_word(this.wg,this.graph),this.draw_link(this.hg,this.graph)}},{key:"update_ref",value:function(t,e){"plus"===e?(m.select(t).property("ref",parseInt(m.select(t).property("ref"))+1),m.select(t).classed("active",!0)):"minus"===e&&(m.select(t).property("ref",parseInt(m.select(t).property("ref"))-1),0===parseInt(m.select(t).property("ref"))&&m.select(t).classed("active",!1))}},{key:"draw_state",value:function(t,e){var a=this,n=this,s=e.coCluster,r=e.state_info;this.params.clusterHeight,this.params.packNum,this.params.unitHeight,this.params.unitWidth,this.params.unitMargin,this.params.clusterInterval,this.params.littleTriangleWidth,this.params.littleTriangleHeight;this.clusterSelected.length!==s.colClusters.length&&(this.clusterSelected=s.colClusters.map(function(t,e){return 0}));var i=this.clusterSelected;t.append("line").attr("id","middle_line").attr("x1",0).attr("y1",-1e3).attr("x2",0).attr("y2",1e3).attr("display","none");var o=t.selectAll("g rect").data(s.colClusters,function(t,e){return Array.isArray(t)?String(t.length)+String(e):a.id}),l=function(t,e){i[e]?(i[e]=0,n.redraw_word_link(-1),n.update_ref(m.select(this).select("rect").node(),"minus"),n.graph.link_info[e].forEach(function(t,e){n.update_ref(t.el,"minus"),"none"!==m.select(t.el).attr("display")&&n.update_ref(n.graph.word_info[e].wordCloud.bgHandle.node(),"minus")})):(i[e]=1,n.redraw_word_link(e),n.update_ref(m.select(this).select("rect").node(),"plus"),n.graph.link_info[e].forEach(function(t,e){n.update_ref(t.el,"plus"),"none"!==m.select(t.el).attr("display")&&n.update_ref(n.graph.word_info[e].wordCloud.bgHandle.node(),"plus")}))},u=o.enter().append("g");u.on("mouseenter",function(t,e){n.update_ref(m.select(this).select("rect").node(),"plus"),n.graph.link_info[e].forEach(function(t,e){if(n.update_ref(t.el,"plus"),"none"!==m.select(t.el).attr("display")){n.update_ref(n.graph.word_info[e].wordCloud.bgHandle.node(),"plus");var a=n.graph.word_info[e].wordCloud.bgHandle.property("ref");console.log("word "+e+"'s ref is "+a)}})}).on("mouseleave",function(t,e){console.log("mouse leave"),n.update_ref(m.select(this).select("rect").node(),"minus"),console.log(m.select(this).select("rect").property("ref")),n.graph.link_info[e].forEach(function(t,e){if(n.update_ref(t.el,"minus"),"none"!==m.select(t.el).attr("display")){n.update_ref(n.graph.word_info[e].wordCloud.bgHandle.node(),"minus");var a=n.graph.word_info[e].wordCloud.bgHandle.property("ref");console.log("word "+e+"'s ref is "+a)}})}).on("click",l),u.attr("transform","translate(0,0)").attr("id",function(t,e){return String(t.length)+String(e)}).transition().duration(300).attr("transform",function(t,e){return"translate("+[r.state_cluster_info[e].top_left[0],r.state_cluster_info[e].top_left[1]]+")"}),u.each(function(t,a){e.state_info.state_cluster_info[a].el=this});u.append("rect").classed("hidden-cluster",!0).classed("active",!1).property("ref",0).transition().duration(400).attr("width",function(t,e){return r.state_cluster_info[e].width}).attr("height",function(t,e){return r.state_cluster_info[e].height}).attr("x",0).attr("y",0);u.append("g").selectAll("rect").data(function(t){return t}).enter().append("rect").on("mouseover",function(t,e){r.state_info[t].selected||m.select(this).classed("unit-active",!0)}).on("mouseleave",function(t,e){r.state_info[t].selected||m.select(this).classed("unit-active",!1)}).on("click",function(t,e){r.state_info[t].selected?(r.state_info[t].selected=!1,m.select(this).classed("unit-active",!1),y.bus.$emit(y.DESELECT_UNIT,t,n.compare)):(r.state_info[t].selected=!0,m.select(this).classed("unit-active",!0),y.bus.$emit(y.SELECT_UNIT,t,n.compare))}).transition().duration(400).attr("width",function(t){return r.state_info[t].width}).attr("height",function(t){return r.state_info[t].height}).attr("x",function(t){return r.state_info[t].top_left[0]}).attr("y",function(t){return r.state_info[t].top_left[1]}).attr("fill",n.unitNormalColor).attr("fill-opacity",.3).each(function(t){e.state_info.state_info[t].el=this})}},{key:"sum",value:function(t){return t.reduce(function(t,e){return t+e},0)}},{key:"draw_word",value:function(t,e){var a=this,n=this,s=e.word_info;s.forEach(function(e,r){if(e.wordCloud){var i=parseInt(e.wordCloud.bgHandle.property("ref")),o=e.wordCloud.bgHandle.property("selected"),l=e.wordCloud.bgHandle.classed("active");e.wordCloud.draw([e.width/2,e.height/2]).transform("translate("+[e.top_left[0]+e.width/2,e.top_left[1]+e.height/2]+")"),e.wordCloud.bgHandle.property("ref",i).property("selected",o).classed("wordcloud",!0).classed("active",l)}else{var u=t.append("g").on("mouseenter",function(){n.graph.link_info.forEach(function(t,e){n.update_ref(t[r].el,"plus"),"none"!==m.select(t[r].el).attr("display")&&n.update_ref(m.select(n.graph.state_info.state_cluster_info[e].el).select("rect").node(),"plus")}),n.update_ref(e.wordCloud.bgHandle.node(),"plus")}).on("mouseleave",function(){n.graph.link_info.forEach(function(t,e){n.update_ref(t[r].el,"minus"),"none"!==m.select(t[r].el).attr("display")&&n.update_ref(m.select(n.graph.state_info.state_cluster_info[e].el).select("rect").node(),"minus")}),n.update_ref(e.wordCloud.bgHandle.node(),"minus")}).on("click",function(){e.wordCloud.bgHandle.property("selected",~e.wordCloud.bgHandle.property("selected")),n.graph.link_info.forEach(function(t,a){n.update_ref(t[r].el,e.wordCloud.bgHandle.property("selected")?"plus":"minus"),"none"!==m.select(t[r].el).attr("display")&&n.update_ref(m.select(n.graph.state_info.state_cluster_info[a].el).select("rect").node(),e.wordCloud.bgHandle.property("selected")?"plus":"minus")}),n.update_ref(e.wordCloud.bgHandle.node(),e.wordCloud.bgHandle.property("selected")?"plus":"minus")}),c=new _.WordCloud(u,e.width/2,e.height/2,"rect",a.compare).transform("translate("+[e.top_left[0]+e.width/2,e.top_left[1]+e.height/2]+")").color(a.params.posColor);c.update(s[r].words_data),c.bgHandle.property("ref",0).property("selected",!1).classed("wordcloud",!0),e.wordCloud=c}})}},{key:"erase_link",value:function(){this.graph.link_info.forEach(function(t){t.forEach(function(t){m.select(t.el).transition().duration(500).style("opacity",0).remove()})})}},{key:"erase_word",value:function(){this.graph.word_info.forEach(function(t){t.wordCloud.destroy()})}},{key:"erase_state",value:function(){this.graph.state_info.state_cluster_info.forEach(function(t){m.select(t.el).transition().duration(500).style("fill-opacity",1e-6).style("opacity",1e-6).remove()})}},{key:"createLink",value:function(t){return"M"+t.source.x+","+t.source.y+"C"+(t.source.x+t.target.x)/2+","+t.source.y+" "+(t.source.x+t.target.x)/2+","+t.target.y+" "+t.target.x+","+t.target.y}},{key:"flatten",value:function(t){var e=this;return t.reduce(function(t,a){return t.concat(Array.isArray(a)?e.flatten(a):a)},[])}},{key:"draw_link",value:function(t,e){var a=this,n=e.link_info,s=m.extent(this.flatten(n).map(function(t){return t.strength})),r=Math.max(Math.abs(s[0]),Math.abs(s[1])),i=this.strengthThresholdPercent.map(function(t){return t*r});n.forEach(function(e,n){e.forEach(function(e,n){if(e.el)m.select(e.el).attr("display",Math.abs(e.strength)<i[0]||Math.abs(e.strength)>i[1]?"none":"").transition().duration(300).attr("stroke-width",a.strokeWidth(e.strength)).attr("d",a.createLink(e));else{var s=t.append("path").classed("link",!0).classed("active",!1).classed(e.strength>0?"positive":"negative",!0).property("ref",0).attr("d",a.createLink(e)).attr("stroke-width",a.strokeWidth(e.strength)).attr("opacity",.15).attr("display",Math.abs(e.strength)<i[0]||Math.abs(e.strength)>i[1]?"none":"");e.el=s.node()}})})}},{key:"draw",value:function(t){var e=this;t.colSizes.reduce(function(t,e){return Math.max(t,e)}),t.labels.length;this.params.computeParams(t.labels.length,1,t.colSizes),this.dx=this.stateClusterWordCloudDX,this.dy=this.params.wordCloudChordLength/2-this.middle_line_y/2,console.log("dx is "+this.dx+", dy is "+this.dy);var a=(t.aggregation_info,this.calculate_state_info(t,this.params.mode));e.graph={state_info:a,coCluster:t,sentence_info:[]},this.draw_state(this.hg,e.graph),this.redraw_word_link(),this.translateX(0)}},{key:"translateX",value:function(t){this.params.middleLineOffset+=t,this.hg.attr("transform","translate("+[this.middle_line_x,this.middle_line_y]+")"),this.wg.attr("transform","translate("+[this.middle_line_x+this.dx,this.middle_line_y+this.dy]+")")}},{key:"adjustdx",value:function(t){this.dx=t,this.wg.attr("transform","translate("+[this.middle_line_x+this.dx,this.middle_line_y+this.dy]+")"),this.redraw_word_link()}},{key:"destroy",value:function(){this.graph&&(this.deleteAllSentences(),this.erase_state(),this.erase_link(),this.erase_word(),this.topg.transition().duration(300).attr("transform","scale(0.01, 0.01)").style("opacity",1e-6).remove(),this.topg=this.svg.append("g"),this.hg=this.topg.append("g"),this.wg=this.topg.append("g"))}},{key:"dxOffset",get:function(){this.client_width,this.client_height;return 0}},{key:"stateClusterWordCloudDX",get:function(){return this.client_width*(-this.params.dxShrinkFactor*this.sentences.length)+this.dxOffset}},{key:"client_width",get:function(){return this.params.width}},{key:"client_height",get:function(){return this.params.height}},{key:"middle_line_x",get:function(){return this.params.middleLineX}},{key:"middle_line_y",get:function(){return this.params.middleLineY}},{key:"nSentence",get:function(){return this.sentences.length}}]),t}()},312:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=1+~~((e-t-1)/a);return(0,i.default)({length:n},function(e,n){return t+n*a})}Object.defineProperty(e,"__esModule",{value:!0});var r=a(50),i=n(r),o=a(21),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(o),u=a(165),c=a(11),h=a(32),d=n(h),f={lineLength:30,wordWidth:50,interval:20,color:l.scaleOrdinal(l.schemeCategory10)};e.default={name:"InfoBoard",data:function(){return{chart:null,labelBoard:null,shared:c.bus.state,statistics:null,layoutParams:f,wordsStatistics:null,unitsStatistics:null,top_k:4}},props:{height:{type:Number,default:600},id:{type:String,default:"info-board"},type:{type:String,default:"state"},compare:{type:Boolean,default:!1}},computed:{header:function(){var t="state"===this.type?"Hidden State":"Word";return"Info: "+(this.shared.compare?"["+this.selectedModel+"] "+t:t)},svgId:function(){return this.id+"-svg"},selectedLayer:function(){return this.compare?this.shared.selectedLayer2:this.shared.selectedLayer},selectedModel:function(){return this.compare?this.shared.selectedModel2:this.shared.selectedModel},selectedState:function(){return this.compare?this.shared.selectedState2:this.shared.selectedState},selectedUnits:function(){return"state"===this.type?this.compare?this.shared.selectedUnits2:this.shared.selectedUnits:0},selectedWords:function(){return"word"===this.type?this.compare?this.shared.selectedWords2:this.shared.selectedWords:0},selectedNode:function(){return"word"===this.type?this.compare?this.shared.selectedNode2:this.shared.selectedNode:0}},watch:{width:function(){this.selectedLayer&&this.selectedModel&&this.selectedState&&("word"===this.type&&this.wordsStatistics?this.repaintWord():"state"===this.type&&this.unitsStatistics&&this.repaintState())},selectedUnits:function(){var t=this;if(this.selectedUnits){var e=this.selectedModel,a=this.selectedState,n=this.selectedLayer;c.bus.loadStatistics(e,a,n).then(function(){t.statistics=c.bus.getStatistics(e,a,n),t.unitsStatistics=t.selectedUnits.map(function(e,a){var n=t.statistics.statesData[e],s=n.mean.map(function(t,e){return{mean:n.mean[e],range1:[n.low1[e],n.high1[e]],range2:[n.low2[e],n.high2[e]],word:n.words[e]}});return s.sort(function(t,e){return t.mean-e.mean}),s.splice(t.top_k,s.length-2*t.top_k),s}),t.repaintState()})}},selectedWords:function(){var t=this;if(this.selectedWords){var e=this.selectedModel,a=this.selectedState,n=this.selectedLayer;c.bus.loadStatistics(e,a,n).then(function(){t.statistics=c.bus.getStatistics(e,a,n),t.wordsStatistics=t.selectedWords.map(function(e,a){var n=t.statistics.statOfWord(e.text);return n.color=t.selectedWords[a].color,n}),t.repaintWord()})}},selectedNode:function(){var t=this;if(this.selectedNode){var e=this.selectedModel,a=this.selectedState,n=this.selectedLayer;d.default.getWordStatistics(e,a,n,this.selectedNode.word,function(e){if(200===e.status){var a=e.data;a.word=a.words,a.range1=a.low1.map(function(t,e){return[t,a.high1[e]]}),a.range2=a.low2.map(function(t,e){return[t,a.high2[e]]}),a.color=t.layoutParams.color(0);var n={mean:t.selectedNode.response,color:t.layoutParams.color(1),word:a.word+"(sentence)"};t.wordsStatistics=[a,n],console.log(t.selectedNode),t.repaintWord()}})}},compare:function(){this.init()},type:function(){this.init()}},methods:{init:function(){this.chart&&this.chart.clean(),this.labelBoard&&this.labelBoard.selectAll("rect, text, path").remove(),this.chart=new u.Chart(l.select("#"+this.svgId),this.width,this.height).background("lightgray",0),this.labelBoard=l.select("#"+this.svgId+"2")},repaintWord:function(){var t=this;if(this.chart.clean().resize(this.width,this.height),this.labelBoard.selectAll("rect, text, path").remove(),!this.wordsStatistics.length)return void console.log("Painting no words");var e=this.layoutParams,a=(e.color,e.lineLength+e.wordWidth+e.interval);this.chart.margin(20,30,20,30).xAxis("dim").yAxis("response");var n=this.wordsStatistics[0].sort_idx,r=1+~~(n.length/200),i=s(0,n.length,r);n=i.map(function(t){return n[t]}),this.chart.line([[0,0],[this.wordsStatistics[0].mean.length,0]]).attr("stroke","#000"),this.wordsStatistics.forEach(function(s,i){t.chart.line(n.map(function(t){return s.mean[t]}),function(t,e){return e*r},function(t){return t}).attr("stroke-width",1).attr("stroke",s.color).attr("stroke-opacity",.6),s.range1&&t.chart.area(n.map(function(t){return s.range1[t]}),function(t,e){return e*r},function(t){return t[0]},function(t){return t[1]}).attr("fill",s.color).attr("fill-opacity",.15).attr("stroke",s.color).attr("stroke-opacity",.1),s.range2&&t.chart.area(n.map(function(t){return s.range2[t]}),function(t,e){return e*r},function(t){return t[0]},function(t){return t[1]}).attr("fill",s.color).attr("fill-opacity",.15).attr("stroke",s.color).attr("stroke-opacity",.05),t.labelBoard.append("rect").attr("x",a*i+20).attr("y",10).attr("width",e.lineLength).attr("height",1).attr("fill",s.color),t.labelBoard.append("text").attr("x",a*i+30+e.lineLength).attr("y",15).text(s.word).style("font-size",12),0===i&&t.labelBoard.append("path").attr("d","M"+(30+e.lineLength)+" 20 H "+(7*s.word.length+30+e.lineLength)).style("stroke",s.color)}),this.chart.draw()},repaintState:function(){var t=this;if(this.chart.clean().resize(this.width,this.height),this.labelBoard.selectAll("path, text").remove(),!this.selectedUnits.length)return void console.log("Painting no states");var e=(this.width-20)/this.unitsStatistics.length,a=this.top_k;this.unitsStatistics.forEach(function(n,r){var i=r===t.unitsStatistics.length-1?"r":" ",o=r===t.unitsStatistics.length-1?20:0,l=r===t.unitsStatistics.length-1?e+20:e,u=t.chart.subChart(l,t.height).xAxis(i).yAxis("words");u.axis.y.tickFormat(function(t){if(-1<t&&t<2*a)return n[t].word}).tickValues(s(0,2*a,1)),u.axis.x.ticks(6),u.margin(20,o,20,55).translate(e*r,0).rotate(),u.box(n,6,function(t,e){return e},function(t){return t.mean},function(t){return t.range1},function(t){return t.range2}).attr("fill","steelblue").attr("stroke","black").attr("stroke-width",0).attr("fill-opacity",.5),u.line([[a-.5,u.extents[1][0]],[a-.5,u.extents[1][1]]]).style("stroke","#333").style("stroke-dasharray","5 5").style("stroke-opacity",.6);var c=e*r+e/2-6;t.labelBoard.append("text").attr("x",c).attr("y",15).text("Dim: "+t.selectedUnits[r]).style("font-size",12),0===r&&t.labelBoard.append("path").attr("d","M"+c+" 20 H "+(6*t.selectedUnits[0].toString().length+30+c)).style("stroke","#a36")}),this.chart.draw()}},mounted:function(){this.width=this.$el.clientWidth-10,this.init()}}},313:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(11),s=a(280),r=function(t){return t&&t.__esModule?t:{default:t}}(s);e.default={name:"InfoView",components:{InfoBoard:r.default},data:function(){return{shared:n.bus.state,type1:"state",type2:"word"}},props:{height:{type:Number,default:300}},computed:{compare:function(){return this.shared.compare}},methods:{},mounted:function(){var t=this;n.bus.$on(n.SELECT_UNIT,function(e,a){t.compare&&(a?t.type1="state":t.type2="state")}),n.bus.$on(n.SELECT_WORD,function(e,a){t.compare&&(a?t.type1="word":t.type2="word")}),n.bus.$on(n.SELECT_SENTECE_NODE,function(e,a){t.compare&&(a?t.type1="word":t.type2="word")})}}},314:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(718),r=n(s),i=a(719),o=n(i),l=a(711),u=n(l),c=a(712),h=n(c),d=a(11);e.default={name:"MainView",data:function(){return{activeTab:"project",shared:d.bus.state,width:800}},props:{height:{type:Number,default:700}},methods:{handleClick:function(t,e){}},computed:{compare:function(){return this.shared.compare}},components:{ProjectView:r.default,TestView:o.default,ArcView:u.default,ClusterView:h.default},mounted:function(){this.width=this.$el.clientWidth}}},315:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(71),s=function(t){return t&&t.__esModule?t:{default:t}}(n),r=a(11);e.default={name:"ModelConfig",data:function(){return{shared:r.bus.state,states:[],selectedState:null,selectedModel:null,selectedLayer:null,posSwitch:!1,config:null,layout:{clusterNum:2,strokeControlStrength:100,linkFilterThreshold:[0,1],stateClip:1,mode:"width"},sentences:[],inputVisible:!1,inputValue:"",mode:!1,color:["#09adff","#ff5b09"]}},props:{toggle:{type:Function,default:function(){}},compare:{type:Boolean,default:!1}},computed:{availableModels:function(){return this.shared.availableModels},colorType:function(){return this.compare?"gray":""},layerNum:function(){return this.config?this.config.LayerNum:0},maxWidth:function(){return 20}},watch:{selectedModel:function(t){var e=this;t&&r.bus.loadModelConfig(t).then(function(){var a=r.bus.availableStates(t);if(a){e.states=a,e.selectedState=e.states[0];var n=r.bus.state.modelConfigs[t];e.config={Cell:n.model.cell_type,LayerNum:n.model.cells.length,LayerSize:n.model.cells[0].num_units},e.posSwitch=!1,e.selectedLayer=e.config.LayerNum-1,e.sentences=[],r.bus.$emit(r.SELECT_MODEL,e.selectedModel,e.compare),r.bus.$emit(r.CHANGE_LAYOUT,e.layout,e.compare)}}).catch(function(t){return console.log(t)})},selectedState:function(t){"state"!==t&&"state_c"!==t&&"state_h"!==t||r.bus.$emit(r.SELECT_STATE,this.selectedState,this.compare)},selectedLayer:function(t){r.bus.$emit(r.SELECT_LAYER,t,this.compare)},posSwitch:function(t){this.compare?this.shared.renderPos2=t:this.shared.renderPos=t}},methods:{stateName:function(t){switch(t){case"state_c":return"cell state";case"state_h":case"state":return"hidden state";default:return"Unknown"}},layoutChange:function(){console.log("Layout changed"),this.layout.mode=this.mode?"width":"height";var t=(0,s.default)({},this.layout);r.bus.$emit(r.CHANGE_LAYOUT,t,this.compare)},closeSentence:function(t){var e=this.sentences.indexOf(t);-1!==e&&(r.bus.$emit(r.CLOSE_SENTENCE,t,this.compare),this.sentences.splice(e,1))},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(e){t.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.inputValue;t&&(r.bus.$emit(r.EVALUATE_SENTENCE,t,this.compare),this.sentences.push(t)),this.inputVisible=!1,this.inputValue=""},colorChange:function(t){r.bus.$emit(r.SELECT_COLOR,this.color)}},mounted:function(){}}},316:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(35),r=(n(s),a(33)),i=(n(r),a(11)),o=a(715),l=n(o);e.default={name:"ModelView",components:{ModelConfig:l.default},data:function(){return{compare:!1,shared:i.bus.state}},mounted:function(){this.getAvailableModels()},computed:{},methods:{getAvailableModels:function(){var t=this;console.log("getting available models..."),i.bus.loadAvailableModels(),this.shared.availableModels||setTimeout(function(){t.getAvailableModels()},2e3)},modelColor:function(t){return 1===t?"primary":"success"},toggleCompare:function(){this.compare=!this.compare,this.compare||(this.selectedModel2=null,this.selectedState2=null,this.states2=[],i.bus.$emit(i.SELECT_MODEL,null,!0),i.bus.$emit(i.SELECT_STATE,null,!0))},stateName:function(t){switch(t){case"state_c":return"c_state";case"state_h":case"state":return"h_state";default:return"Unknown"}}},watch:{}}},317:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){for(var e=r(t),a=100/(e[0][1]-e[0][0]),n=100/(e[1][1]-e[1][0]),s=Math.max(a,n),i=0;i<t.length;i++)t[i].coords[0]*=s,t[i].coords[1]*=s}function r(t){return[x.extent(t,function(t){return t.coords[0]}),x.extent(t,function(t){return t.coords[1]})]}function i(t,e){t.active||(x.select(this).classed("active",!0),t.links.forEach(function(t){t.active=!0,t._target.active=!0}),u(e),h(e))}function o(t,e){t.active||(x.select(this).classed("active",!1),t.links.forEach(function(t){t.active=!1,t._target.active=!1}),u(e),h(e))}function l(t,e){t.active?(t.active=!1,o(t,e)):(i(t,e),t.active=!0),u(e),h(e),x.select(this).classed("active",t.active)}function u(t){t.links.classed("active",function(t){return t.active}).style("opacity",function(e){return e.strength*(e.active?t.params.opacityHigh:t.params.opacity)}).style("stroke",function(t){return t.active?"#6b7":t.type<0?"#68b":"#c66"})}function c(t){t.stateNodes.classed("active",function(t){return t.active})}function h(t){t.wordNodes.classed("active",function(t){return t.active})}Object.defineProperty(e,"__esModule",{value:!0});var d=a(168),f=n(d),p=a(72),g=n(p),v=a(50),m=n(v),y=a(25),_=n(y),w=a(26),k=n(w),b=a(21),x=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(b),C=a(11),S=a(307),E={rScale:.3,radius:3,opacity:.4,opacityHigh:1,defaultAlpha:.35,repel:-5,strength_thred:.6,color:x.scaleOrdinal(x.schemeCategory10),color2:x.scaleOrdinal(x.schemeCategory20),clusterNum:0};e.default={name:"ProjectGraph",defaultConfig:E,data:function(){return{fdGraph:null}},props:{width:{type:Number,default:800},height:{type:Number,default:800},graphData:{type:Object,required:!0},svgId:{type:String,required:!0},config:{type:Object,default:null},ready:{type:Boolean,default:!1}},watch:{width:function(t){this.fdGraoh.updateScale()},height:function(t){this.fdGraph.updateScale()},ready:function(t){t&&this.reset()}},methods:{reset:function(){this.fdGraph&&this.fdGraph.destroy();var t=document.getElementById(this.svgId);this.fdGraph=new M(t,this.config),s(this.graphData.states);var e=r(this.graphData.states);this.fdGraph.updateScale(e),this.fdGraph.buildGraph(this.graphData.strength,this.graphData.states),this.fdGraph.insertElements(),this.fdGraph.initSimulation(),this.fdGraph.startSimulation()},refreshGraph:function(t){t&&(this.fdGraph.refresh(),this.fdGraph.clusterStates(this.graphData.signature))}},mounted:function(){C.bus.$on("REFRESH_PROJECT_GRAPH",this.refreshGraph)}};var M=function(){function t(e,a,n){(0,_.default)(this,t);this.svg=x.select("#"+e.id),this.svgEl=e,this.graph=null,this.simulation=null,this.stateNodes=null,this.wordNodes=null,this.links=null,this.scale={x:null,y:null,invert_x:null,invert_y:null},this.extents=null,this.strengthfn=n||function(t){return Math.pow(t/2,3)},this.params=a}return(0,k.default)(t,[{key:"buildGraph",value:function(t,e){var a=this;e.forEach(function(t){t.id=t.layer+"-"+t.state_id,t.fx=t.coords[0],t.fy=t.coords[1],t.links=[]}),t.forEach(function(t){t.id=t.word,t.links=[]});var n=(0,m.default)(new g.default(e.map(function(t){return t.layer}))).sort(),s=[],r={};e.forEach(function(t){r[t.id]=t}),t.forEach(function(t){var e=0;t.strength.forEach(function(i){var o=0;i.forEach(function(i){var l=i;if(Math.abs(l)>a.params.strength_thred){var u={source:n[e]+"-"+o,target:t.id,strength:a.strengthfn(Math.abs(l)),type:(0,f.default)(i)};u._source=r[u.source],u._target=t,s.push(u),r[u.source].links.push(u),t.links.push(u)}o++}),e++})}),console.log("done building graph"),this.graph={nodes:t.concat(e),links:s,id2states:r,wordNodes:t,stateNodes:e}}},{key:"initSimulation",value:function(){var t=x.forceManyBody().strength(-30).distanceMax(4),e=t.initialize;t.initialize=function(t){e(t.filter(function(t){t.hasOwnProperty("word")}))};var a=x.forceCollide().strength(.5).radius(1);this.simulation=x.forceSimulation().alpha(this.params.defaultAlpha).force("link",x.forceLink().id(function(t){return t.id}).distance(function(t){return t.type<0?50:5}).strength(function(t){return t.strength})).force("collide",a).force("charge",t)}},{key:"insertElements",value:function(){var t=this,e=this.svg.append("g").attr("class","states");this.stateNodes=e.selectAll("circle").data(this.graph.stateNodes).enter().append("circle").attr("r",function(e){return e.links.length>0?e.links.length*t.params.rScale+t.params.radius:0}).style("fill",function(e,a){return t.params.color(e.label)}).classed("active",!1).on("mouseover",function(e){return i(e,t)}).on("mouseout",function(e){return o(e,t)}).on("click",function(e){return l(e,t)}),this.stateNodes.append("title").text(function(t){return t.id}),this.links=this.svg.append("g").attr("class","links").selectAll("line").data(this.graph.links).enter().append("line").classed("active",!1),this.wordNodes=this.svg.append("g").attr("class","words").selectAll("text").data(this.graph.wordNodes).enter().append("text").classed("active",!1).call(x.drag().on("start",function(e){x.event.active||t.simulation.alphaTarget(t.params.defaultAlpha).restart(),e.fx=e.x,e.fy=e.y,e.links.forEach(function(t){t.active=!0}),u(t)}).on("drag",function(e){e.fx=t.scale.invert_x(x.mouse(t.svgEl)[0]),e.fy=t.scale.invert_y(x.mouse(t.svgEl)[1])}).on("end",function(e){x.event.active||t.simulation.alphaTarget(0),e.fx=null,e.fy=null,e.links.forEach(function(t){t.active=!1}),u(t)})).text(function(t){return t.id}),u(t),h(t),c(t)}},{key:"startSimulation",value:function(){var t=this;t.simulation.nodes(t.graph.nodes).on("tick",function(){return t.ticked(t.links,t.wordNodes,t.stateNodes)}),t.simulation.force("link").links(t.graph.links)}},{key:"ticked",value:function(t,e,a){var n=this;t.attr("x1",function(t){return n.scale.x(t.source.x)}).attr("y1",function(t){return n.scale.y(t.source.y)}).attr("x2",function(t){return n.scale.x(t.target.x)}).attr("y2",function(t){return n.scale.y(t.target.y)}),e.attr("x",function(t){return n.scale.x(t.x)}).attr("y",function(t){return n.scale.y(t.y)}),a.attr("cx",function(t){return n.scale.x(t.x)}).attr("cy",function(t){return n.scale.y(t.y)})}},{key:"updateScale",value:function(t){t&&(this.extents=t);var e=this.width,a=this.height,n=this.extents[0],s=this.extents[1],r=(n[0]+n[1])/2,i=(s[0]+s[1])/2,o=.9*Math.min(e/(n[1]-n[0]),a/(s[1]-s[0]));this.scale.x=function(t){return(t-r)*o+e/2},this.scale.y=function(t){return(i-t)*o+a/2},this.scale.invert_x=function(t){return(t-e/2)/o+r},this.scale.invert_y=function(t){return i-(t-a/2)/o}}},{key:"clusterStates",value:function(t){var e=this,a=this.params.clusterNum;if(!(a<2)){var n=(0,S.kmeans)(t,a,1e3);this.graph.stateNodes.forEach(function(t,e){t.cluster=n[e]}),this.stateNodes.style("fill",function(t,n){return a<11?e.params.color(t.cluster):e.params.color2(t.cluster)})}}},{key:"destroy",value:function(){console.log("Destroying Graph "+this.svgEl.id),this.simulation.nodes([]),this.simulation.force("link").links([]),this.links.remove(),this.stateNodes.remove(),this.wordNodes.remove()}},{key:"refresh",value:function(){u(this),c(this),h(this)}},{key:"width",get:function(){return this.svgEl.clientWidth}},{key:"height",get:function(){return this.svgEl.clientHeight}}]),t}()},318:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(34),r=n(s),i=a(71),o=n(i),l=a(21),u=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);e.default=t}(l),a(32)),c=n(u),h=a(11),d=a(717),f=n(d);e.default={name:"ProjectView",props:{width:{type:Number,default:800},height:{type:Number,default:600}},data:function(){return{model:"",states:"",ready:!1,graphData:{states:null,strength:null},config:(0,o.default)({},f.default.defaultConfig),cache:{},shared:h.bus.state}},components:{ProjectGraph:f.default},computed:{selectedState:function(){return this.shared.selectedState}},watch:{selectedState:function(t,e){h.bus.state.selectedState=t,t!==e&&("state"!==t&&"state_c"!==t&&"state_h"!==t||this.reset())}},methods:{paneId:function(t,e){return t+"-"+e+"-svg"},reset:function(){var t=this;this.ready=!1,delete this.graphData.signature,this.config=(0,o.default)({},f.default.defaultConfig),"state"===this.selectedState&&(this.config.strength_thred=.9),"state_h"===this.selectedState&&(this.config.strength_thred=.5),"IMDB"===this.model&&(this.config.strength_thred=0,this.config.strengthFn=function(t){return Math.pow(30*t,2)},this.config.farDistance=120);var e=this.paneId(this.model,this.selectedState);if(Object.prototype.hasOwnProperty.call(this.cache,e))return(0,o.default)(this.graphData,this.cache[e]),void setTimeout(function(){t.ready=!0},100);var a=c.default.getProjectionData(this.model,this.selectedState,{},function(e){t.graphData.states=e.data,console.log("states data loaded")}),n=c.default.getStrengthData(this.model,this.selectedState,{top_k:200},function(e){var a=e.data;t.graphData.strength=[a[163]].concat(a.slice(20,40)),console.log("strength data loaded")});r.default.all([a,n]).then(function(a){t.cache[e]={states:t.graphData.states,strength:t.graphData.strength},setTimeout(function(){t.ready=!0},100),c.default.getStateSignature(t.model,t.selectedState,{},function(a){t.graphData.signature=a.data,t.cache[e].signature=t.graphData.signature,console.log("signature data loaded")})},function(t){console.log("Failed to build force graph!")})},configWatcher:function(){var t=this;if(!1!==this.ready)return this.config.clusterNum>1&&!Object.prototype.hasOwnProperty.call(this.graphData,"signature")?void c.default.getStateSignature(this.model,this.selectedState,{},function(e){t.graphData.signature=e.data,console.log("signature data loaded"),h.bus.$emit("REFRESH_PROJECT_GRAPH",t.ready)}):void h.bus.$emit("REFRESH_PROJECT_GRAPH",this.ready)}},mounted:function(){var t=this;h.bus.$on(h.SELECT_MODEL,function(e,a){a||(console.log("selected model: "+e),t.model=e,h.bus.loadModelConfig(e).then(function(a){var n=h.bus.availableStates(e);n?(t.states=n,setTimeout(function(){t.states[0]===t.selectedState&&t.reset(),t.selectedState=null},100)):console.log("Unknown cell type!")}))})}}},319:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(73),r=n(s),i=a(34),o=n(i),l=a(21),u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(l),c=a(32),h=n(c),d=a(11),f=a(165),p=a(97),g=a(166);e.default={name:"TestView",data:function(){return{chart:null,model:"PTB-LSTM",state:"state_c"}},props:{},computed:{svgId:function(){return"svg-test"}},methods:{init:function(){var t=u.select("#"+this.svgId).attr("width",500).attr("height",500);this.chart=new f.Chart(t,500,500).background("lightgray",0)},draw2:function(){function t(a,n){n=n||0,a.update(e),setTimeout(function(){t(a,n+1)},2e3)}var e=["you","want","more","words","than","this","he","is","she","they","what","million","it","$","<unk>","good","i","by"].map(function(t,e){return{text:t,size:5+25*Math.random(),type:0+Math.round(Math.random())}});t(new p.WordCloud(u.select("#"+this.svgId),120,120).transform("translate(200,200)"))},draw:function(){var t=this;h.default.getWordStatistics(this.model,this.state,-1,"he",function(e){var a=e.data,n=a.sort_idx.map(function(t,e){return a.mean[t]}),s=a.sort_idx.map(function(t,e){return[a.low1[t],a.high1[t]]}),r=a.sort_idx.map(function(t,e){return[a.low2[t],a.high2[t]]});console.log(a);var i=t.chart.subChart(250,200).margin(5,5,20,30).xAxis().yAxis();i.line(n,function(t,e){return e},function(t){return t}),i.area(s,function(t,e){return e},function(t){return t[0]},function(t){return t[1]}).attr("opacity",.4),i.area(r,function(t,e){return e},function(t){return t[0]},function(t){return t[1]}).attr("opacity",.2)});var e=void 0,a=h.default.getStateStatistics(this.model,this.state,-1,200,function(t){var a=t.data;e=a.mean[0].map(function(t,e){return{freqs:a.freqs,mean:a.mean.map(function(t){return t[e]}),low1:a.low1.map(function(t){return t[e]}),low2:a.low2.map(function(t){return t[e]}),high1:a.high1.map(function(t){return t[e]}),high2:a.high2.map(function(t){return t[e]}),rank:a.sort_idx.map(function(t){return t.findIndex(function(t){return t===e})})}})}),n=void 0,s=h.default.getVocab(this.model,200,function(t){n=t.data});o.default.all([a,s]).then(function(){console.log(e),console.log(n);var a=e[10];a=a.freqs.map(function(t,e){return{freqs:t,mean:a.mean[e],range1:[a.low1[e],a.high1[e]],range2:[a.low2[e],a.high2[e]],rank:a.rank[e],word_id:e,word:n[e]}});var s=a.sort(function(t,e){return t.mean-e.mean}),r=s.slice(0,10).concat(s.slice(s.length-10)),i=t.chart.subChart(250,200).translate(250,0).margin(5,30,40,5).xAxis().yAxis("right");i.axis.x.tickFormat(function(t,e){return r[t].word}).ticks(20),i.box(r,5,function(t,e){return e},function(t){return t.mean},function(t){return t.range1},function(t){return t.range2}).attr("fill","steelblue").attr("stroke","gray").attr("fill-opacity",.5),t.chart.draw(),i.axisHandles.x.selectAll("text").attr("y",0).attr("x",-9).attr("dy",".35em").attr("transform","rotate(-90)").style("text-anchor","end")})},draw_arc:function(){var t=u.scaleOrdinal(u.schemeCategory10),e=u.select("#"+this.svgId).attr("width",500).attr("height",500),a=[{start:0,end:2*Math.PI/8},{start:2*Math.PI/8,end:2*Math.PI/2},{start:2*Math.PI/2,end:2*Math.PI}],n=e.append("g").attr("transform","translate(250,250)"),s=u.arc().innerRadius(230).outerRadius(240);a.forEach(function(e,a){n.append("path").datum({startAngle:e.start,endAngle:e.end}).style("fill",t(a)).attr("d",s),console.log(s.centroid({startAngle:e.start,endAngle:e.end}))})},draw4:function(){function t(){if(u.event.sourceEvent&&u.event.selection){var t=u.event.selection;t[0]=Math.round(t[0]/(e+a))*(e+a),t[1]=Math.max(Math.round(t[1]/(e+a))*(e+a)-a,t[0]),console.log(u.event.selection),u.select(this).transition().call(u.event.target.move,t)}}var e=(u.scaleOrdinal(u.schemeCategory10),50),a=10,n=["this","is","foy","test","<eos>"],s=(u.scaleTime().domain([new Date(2013,7,1),new Date(2013,7,15)-1]).rangeRound([0,500]),u.select("#"+this.svgId).attr("width",500).attr("height",500).append("g").attr("transform","translate(100,"+500/3+")")),r=(s.selectAll("text").data(n).enter().append("text").text(function(t){return t}).style("text-anchor","middle").attr("transform",function(t,n){return"translate("+[(e+a)*n+e/2,20/1.3]+")"}),s.append("g"));n.forEach(function(t,n){n>0&&r.append("rect").attr("x",n*(e+a)-a).attr("y","0").attr("width",a).attr("height",20).attr("fill","lightgray").attr("stroke-width",2).attr("stroke","blue").attr("opacity",.2),r.append("rect").attr("x",n*(e+a)).attr("y","0").attr("width",e).attr("height",20).attr("fill","lightgray").attr("stroke-width",2).attr("stroke","blue").attr("opacity",.2)}),s.append("g").call(u.brushX().extent([[0,0],[(e+a)*n.length-a,20]]).on("end",t))},drawRect:function(t,e,a){var n=[20,50];t.selectAll(".wordRect").data(u.range(e)).enter().append("rect").attr("x",0).attr("y",function(t){return t*n[1]}).attr("width",n[0]).attr("height",n[1]).attr("fill","lightgray").attr("stroke-width",2).attr("stroke","blue").attr("opacity",.2);var s=u.brushY().extent([[0,0],[n[0],n[1]*e]]).on("end",function(){if(u.event.sourceEvent&&u.event.selection){var t=u.event.selection;t[0]=Math.round(t[0]/n[1])*n[1],t[1]=Math.round(t[1]/n[1])*n[1],u.select(this).transition().call(u.event.target.move,t),console.log(u.event.selection),a([Math.round(t[0]/n[1]),Math.round(t[1]/n[1])])}});t.append("g").call(s).call(s.move,[0,n[1]*e])},draw5:function(){function t(t){var e;console.log("extent_ is "+t);var a=(e=n.tokens).slice.apply(e,(0,r.default)(t));console.log("words is "+a);var s=n.tokens.length/a.length;s=Math.min(s,2);var i=l.getWordPos(t[0])[1];l.transform("scale("+s+")translate("+[100/s,-i]+")")}var e=this,a=d.bus.loadCoCluster("PTB-LSTM","state_c",10,{top_k:300,mode:"raw"}),n=d.bus.evalSentence("What can I do for you?","PTB-LSTM"),s=n.evaluate(),i=500,l=null,c=u.select("#"+this.svgId),h=c.append("g");o.default.all([a,s]).then(function(a){var s=d.bus.getCoCluster("PTB-LSTM","state_c",10,{top_k:300,mode:"raw"}),r=n.getRecords("state_c",-1);console.log(n);var o=c.append("g").attr("transform","translate(0, 50)");l=(0,g.sentence)(h).transform("translate(100, 0)").size([50,i]).sentence(r).coCluster(s).words(n.tokens).draw(),console.log(l.strengthByCluster),e.drawRect(o,n.tokens.length,t)})},draw3:function(){var t=this,e=d.bus.loadCoCluster("PTB-LSTM","state_c",10,{top_k:300,mode:"raw"}),a=d.bus.evalSentence("What can I do for you?","PTB-LSTM"),n=a.evaluate();o.default.all([e,n]).then(function(e){var n=d.bus.getCoCluster("PTB-LSTM","state_c",10,{top_k:300,mode:"raw"}),s=a.getRecords("state_c",-1);console.log(a);var r=(0,g.sentence)(u.select("#"+t.svgId).append("g")).transform("translate(100, 10)").size([50,450]).sentence(s).coCluster(n).words(a.tokens).draw();console.log(r.strengthByCluster)})}},mounted:function(){this.init(),this.draw5()}}},32:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(33),r=n(s),i=a(34),o=n(i),l=a(10),u=n(l),c=a(733),h=n(c);u.default.use(h.default);var d=location.origin,f=u.default.http,p={},g=function(t,e){return t in p?o.default.resolve(e(p[t])):f.get(t).then(function(a){200===a.status&&(p[t]={status:200,data:a.data}),e(p[t])},function(t){throw console.log(t),t})},v=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3],s=d+"/projection?model="+t+"&state="+e;return(0,r.default)(a).forEach(function(t){s+="&"+t+"="+a[t]}),g(s,n)},m=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3],s=d+"/strength?model="+t+"&state="+e;return(0,r.default)(a).forEach(function(t){s+="&"+t+"="+a[t]}),g(s,n)},y=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3],s=d+"/state_signature?model="+t+"&state="+e;return(0,r.default)(a).forEach(function(t){s+="&"+t+"="+a[t]}),g(s,n)},_=function(t){return g(d+"/models/available",t)},w=function(t,e){return g(d+"/models/config/"+t,e)},k=function(t,e,a){var n=d+"/models/evaluate";return f.post(n,{model:t,text:e}).then(function(t){a(t)},function(t){throw console.log(t),t})},b=function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments[4],i=d+"/co_clusters?model="+t+"&state="+e+"&n_cluster="+a;return(0,r.default)(n).forEach(function(t){i+="&"+t+"="+n[t]}),g(i,s)},x=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments[2];return g(d+"/vocab?model="+t+"&top_k="+e,a)},C=function(t,e,a,n,s){return console.log("If no statistics data available, try visit url "+d+"/models/record_default?model="+t+"&set=test for generating state records!"),g(d+"/state_statistics?model="+t+"&state="+e+"&layer="+a+"&top_k="+n,s)},S=function(t,e,a,n,s){return g(d+"/word_statistics?model="+t+"&state="+e+"&layer="+a+"&word="+n,s)},E=function(t,e,a){return g(d+"/pos_statistics?model="+t+"&top_k="+e,a)};e.default={getProjectionData:v,getStrengthData:m,getModels:_,getModelConfig:w,getTextEvaluation:k,getCoCluster:b,getVocab:x,getStateSignature:y,getStateStatistics:C,getWordStatistics:S,getPosStatistics:E}},320:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(32),s=function(t){return t&&t.__esModule?t:{default:t}}(n),r=a(11),i=["88, 126, 182","201, 90, 95"];e.default={name:"TextView",data:function(){return{inputs:null,shared:r.bus.state,isInput:!0,states:[],selectedState:null,selectedLayer:-1,selectedDim:null,cache:{},oldInputs:null,tokens:null,records:null,layerNum:0}},computed:{displayControl:function(){return 0!==this.states.length},layerSize:function(){var t=this.shared.selectedModel;return r.bus.layerSize(t,this.selectedLayer)},sentences:function(){var t=this;return this.records?this.tokens.map(function(e,a){return e.map(function(e,n){return{text:e,value:t.records[a][n][t.selectedState][t.selectedLayer][t.selectedDim]}})}):[]}},watch:{},methods:{color:function(t){return t<0?"rgba("+i[0]+","+-t+")":"rgba("+i[1]+","+t+")"},onSubmit:function(){var t=this;if(null===this.selectedState)return!1;var e=this.shared.selectedModel;if(this.inputs===this.oldInputs)return!0;s.default.getTextEvaluation(e,this.inputs,function(e){var a=e.data;t.tokens=a.tokens,t.records=a.records,t.oldInputs=t.inputs})}},mounted:function(){var t=this;r.bus.$on(r.SELECT_MODEL,function(e){var a=r.bus.availableStates(e);a?(t.states=a,t.layerNum=r.bus.layerNum(e),t.selectedLayer=t.layerNum-1,t.selectedState=t.states[0]):t.states=[]})}}},696:function(t,e){},697:function(t,e){},698:function(t,e){},699:function(t,e){},700:function(t,e){},701:function(t,e){},702:function(t,e){},703:function(t,e){},704:function(t,e){},705:function(t,e){},706:function(t,e){},707:function(t,e){},711:function(t,e,a){a(702);var n=a(12)(a(310),a(727),null,null);t.exports=n.exports},712:function(t,e,a){a(707);var n=a(12)(a(311),a(732),null,null);t.exports=n.exports},713:function(t,e,a){a(703);var n=a(12)(a(313),a(728),"data-v-6411595c",null);t.exports=n.exports},714:function(t,e,a){a(706);var n=a(12)(a(314),a(731),null,null);t.exports=n.exports},715:function(t,e,a){a(704);var n=a(12)(a(315),a(729),null,null);t.exports=n.exports},716:function(t,e,a){a(705);var n=a(12)(a(316),a(730),"data-v-820c27c2",null);t.exports=n.exports},717:function(t,e,a){a(699);var n=a(12)(a(317),a(724),null,null);t.exports=n.exports},718:function(t,e,a){a(697);var n=a(12)(a(318),a(722),null,null);t.exports=n.exports},719:function(t,e,a){a(701);var n=a(12)(a(319),a(726),null,null);t.exports=n.exports},720:function(t,e,a){a(696);var n=a(12)(a(320),a(721),"data-v-0de1765e",null);t.exports=n.exports},721:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"text-view"},[a("h4",{staticClass:"normal"},[t._v("Text")]),t._v(" "),a("hr"),t._v(" "),t.displayControl?a("div",{staticClass:"state-select"},[a("el-radio-group",{attrs:{size:"small"},model:{value:t.selectedState,callback:function(e){t.selectedState=e},expression:"selectedState"}},t._l(t.states,function(t){return a("el-radio-button",{attrs:{label:t}})})),t._v(" "),a("div",{staticClass:"input"},[a("el-col",{staticClass:"label",attrs:{span:4}},[a("span",[t._v("Layer:")])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input-number",{staticStyle:{width:"80%"},attrs:{size:"small",max:t.layerNum-1},model:{value:t.selectedLayer,callback:function(e){t.selectedLayer=e},expression:"selectedLayer"}})],1),t._v(" "),a("el-col",{staticClass:"label",attrs:{span:4}},[a("span",[t._v("Dim:")])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",max:t.layerSize},model:{value:t.selectedDim,callback:function(e){t.selectedDim=e},expression:"selectedDim"}})],1)],1)],1):t._e(),t._v(" "),t.isInput?a("el-input",{staticClass:"text-input",attrs:{type:"textarea",rows:2,placeholder:"Please input"},model:{value:t.inputs,callback:function(e){t.inputs=e},expression:"inputs"}}):t._e(),t._v(" "),a("el-button",{on:{click:t.onSubmit}},[t._v(" Evaluate\n  ")]),t._v(" "),t.records?a("hr"):t._e(),t._v(" "),t.records?a("div",{staticClass:"text-box"},t._l(t.sentences,function(e){return a("div",t._l(e,function(e){return a("span",{style:{backgroundColor:t.color(e.value)}},[t._v(" "+t._s(e.text)+" ")])}))})):t._e()],1)},staticRenderFns:[]}},722:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project"},[a("project-graph",{attrs:{"svg-id":t.paneId(t.model,t.selectedState),width:t.width,height:t.height,"graph-data":t.graphData,ready:t.ready,config:t.config}}),t._v(" "),a("div",{staticClass:"config"},[a("el-col",{attrs:{span:4}},[a("span",[t._v("Cluster No.")])]),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-slider",{attrs:{min:1,max:20},on:{change:t.configWatcher},model:{value:t.config.clusterNum,callback:function(e){t.$set(t.config,"clusterNum",e)},expression:"config.clusterNum"}})],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("span",[t._v("Opacity")])]),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-slider",{attrs:{max:1,step:.05,width:100},on:{change:t.configWatcher},model:{value:t.config.opacity,callback:function(e){t.$set(t.config,"opacity",e)},expression:"config.opacity"}})],1)],1)],1)},staticRenderFns:[]}},723:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h4",{staticClass:"normal"},[t._v(t._s(t.header))]),t._v(" "),a("hr"),t._v(" "),a("svg",{attrs:{id:t.svgId,width:t.width,height:t.height}}),t._v(" "),a("svg",{attrs:{id:t.svgId+"2",width:t.width,height:30}})])},staticRenderFns:[]}},724:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("svg",{staticClass:"project",attrs:{id:t.svgId,width:t.width,height:t.height}})},staticRenderFns:[]}},725:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("el-menu",{staticClass:"header-menu",attrs:{theme:"dark","default-active":"",mode:"horizontal"},on:{select:function(){t.console.log("Hi!")}}},[a("el-menu-item",{staticClass:"logo",attrs:{index:"1"}},[t._v("RNNVis")]),t._v(" "),a("el-menu-item",{attrs:{index:"2"}},[t._v("Info")])],1),t._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"col-bg",attrs:{span:6,gutter:15}},[a("model-view"),t._v(" "),a("br"),t._v(" "),t.compare?t._e():a("info-board",{attrs:{compare:!1,type:"word",id:"info-word",height:1*t.infoHeight}}),t._v(" "),t.compare?t._e():a("info-board",{attrs:{compare:!1,type:"state",id:"info-state",height:.8*t.infoHeight}})],1),t._v(" "),a("el-col",{staticClass:"col-bg",attrs:{span:18,gutter:15}},[a("el-row",[a("main-view",{attrs:{height:t.mainHeight}})],1),t._v(" "),a("el-row",{attrs:{gutter:10}},[t.compare?a("info-view",{attrs:{height:t.infoHeight}}):t._e()],1)],1)],1)],1)},staticRenderFns:[]}},726:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("svg",{attrs:{id:t.svgId}})])},staticRenderFns:[]}},727:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"arc"},[a("div",{staticClass:"header"},[a("el-radio-group",{attrs:{size:"small"},model:{value:t.selectedState,callback:function(e){t.selectedState=e},expression:"selectedState"}},t._l(t.states,function(t){return a("el-radio-button",{attrs:{label:t}})}))],1),t._v(" "),a("svg",{attrs:{id:t.svgId,width:t.width,height:t.height}}),t._v(" "),a("div",{staticClass:"arc_config"},[a("el-col",{attrs:{span:4}},[a("span",[t._v("Cluster No.")])]),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-slider",{attrs:{min:2,max:20},model:{value:t.clusterNum,callback:function(e){t.clusterNum=e},expression:"clusterNum"}})],1)],1)])},staticRenderFns:[]}},728:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-col",{staticClass:"col-bg",attrs:{span:12,gutter:15}},[a("info-board",{attrs:{type:t.type1,id:"info-board-1",height:t.height,compare:t.compare}})],1),t._v(" "),a("el-col",{staticClass:"col-bg",attrs:{span:12,gutter:15}},[a("info-board",{attrs:{type:t.type2,id:"info-board-2",height:t.height,compare:!1}})],1)],1)},staticRenderFns:[]}},729:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"grid-content"},[a("el-form",{attrs:{"label-position":"left","label-width":"30%"}},[a("el-form-item",{attrs:{label:t.compare?"Model 2":"Model"}},[a("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"Select A Model",size:"small"},model:{value:t.selectedModel,callback:function(e){t.selectedModel=e},expression:"selectedModel"}},t._l(t.availableModels,function(t,e){return a("el-option",{attrs:{value:t,label:t}})})),t._v(" "),t.compare?a("el-button",{attrs:{icon:"delete",size:"small"},on:{click:t.toggle}}):t._e()],1),t._v(" "),t.config?a("div",{staticClass:"el-form-item"},t._l(Object.keys(t.config),function(e){return a("el-tag",{attrs:{type:t.colorType}},[t._v(t._s(e)+": "+t._s(t.config[e]))])})):t._e(),t._v(" "),t.config?a("hr",{staticClass:"local-hr"}):t._e(),t._v(" "),t.states.length?a("el-form-item",{attrs:{label:"Hidden State"}},[a("el-radio-group",{attrs:{size:"small"},model:{value:t.selectedState,callback:function(e){t.selectedState=e},expression:"selectedState"}},t._l(t.states,function(e){return a("el-radio-button",{attrs:{label:e}},[t._v(t._s(t.stateName(e)))])}))],1):t._e(),t._v(" "),t.layerNum?a("el-form-item",{attrs:{label:"Layer"}},[a("el-input-number",{staticStyle:{width:"100px","margin-top":"5px"},attrs:{size:"small",max:t.layerNum-1},model:{value:t.selectedLayer,callback:function(e){t.selectedLayer=e},expression:"selectedLayer"}})],1):t._e(),t._v(" "),t.states.length?a("el-form-item",{attrs:{label:"POS Tag"}},[a("el-switch",{attrs:{"on-text":"","off-text":""},model:{value:t.posSwitch,callback:function(e){t.posSwitch=e},expression:"posSwitch"}}),t._v(" "),a("span",{staticClass:"align",staticStyle:{"margin-left":"30px"}},[t._v("Align")]),t._v(" "),a("el-switch",{attrs:{"on-text":"","off-text":""},on:{change:t.layoutChange},model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}})],1):t._e(),t._v(" "),t.selectedModel?a("el-form-item",{attrs:{label:"Sentences"}},[t.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleInputConfirm(e):null}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ New Sentence")])],1):t._e(),t._v(" "),t.sentences.length?a("div",{staticClass:"sentence-container"},t._l(t.sentences,function(e){return a("el-tag",{attrs:{closable:!0,type:t.colorType},on:{close:function(a){t.closeSentence(e)}}},[a("a",[t._v(t._s(e))])])})):t._e(),t._v(" "),t.selectedState?a("hr",{staticClass:"local-hr"}):t._e(),t._v(" "),t.selectedState?a("el-form-item",{attrs:{label:"Cluster Num"}},[a("el-slider",{staticStyle:{width:"80%"},attrs:{min:2,max:20},on:{change:t.layoutChange},model:{value:t.layout.clusterNum,callback:function(e){t.$set(t.layout,"clusterNum",e)},expression:"layout.clusterNum"}})],1):t._e(),t._v(" "),t.selectedState?a("el-form-item",{staticStyle:{"margin-top":"-7px","padding-bottom":"-10px"},attrs:{label:"Stroke Width"}},[a("el-slider",{staticStyle:{width:"80%"},attrs:{min:0,max:t.maxWidth,step:.1},on:{change:t.layoutChange},model:{value:t.layout.strokeControlStrength,callback:function(e){t.$set(t.layout,"strokeControlStrength",e)},expression:"layout.strokeControlStrength"}})],1):t._e(),t._v(" "),t.selectedState?a("el-form-item",{staticStyle:{"margin-top":"-7px"},attrs:{label:"Link Filter"}},[a("el-slider",{staticStyle:{width:"80%"},attrs:{range:"",min:0,max:1,step:1e-4},on:{change:t.layoutChange},model:{value:t.layout.linkFilterThreshold,callback:function(e){t.$set(t.layout,"linkFilterThreshold",e)},expression:"layout.linkFilterThreshold"}})],1):t._e(),t._v(" "),t.selectedState?a("el-form-item",{staticStyle:{"margin-top":"-7px"},attrs:{label:"State Clip"}},[a("el-slider",{staticStyle:{width:"80%"},attrs:{min:0,max:10,step:1},on:{change:t.layoutChange},model:{value:t.layout.stateClip,callback:function(e){t.$set(t.layout,"stateClip",e)},expression:"layout.stateClip"}})],1):t._e()],1)],1)},staticRenderFns:[]}},730:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h4",{staticClass:"normal"},[t._v("Models")]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"content model-view"},[a("model-config",{attrs:{compare:!1}}),t._v(" "),t.compare?a("hr"):t._e(),t._v(" "),t.compare?a("model-config",{attrs:{compare:!0,toggle:t.toggleCompare}}):t._e(),t._v(" "),a("hr"),t._v(" "),a("el-button",{attrs:{size:"small"},on:{click:t.toggleCompare}},[t._v("Compare Model")])],1)])},staticRenderFns:[]}},731:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h4",{staticClass:"normal"},[t._v("Main")]),t._v(" "),a("hr"),t._v(" "),t.compare?a("cluster-view",{attrs:{width:t.width/2-15,height:t.height,compare:!0}}):t._e(),t._v(" "),a("cluster-view",{attrs:{width:t.compare?t.width/2-15:t.width,height:t.height,compare:!1}})],1)},staticRenderFns:[]}},732:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("svg",{attrs:{id:t.svgId,width:t.width,height:t.height}},[a("defs",[a("linearGradient",{attrs:{id:"state-legend"}},[a("stop",{staticClass:"stop1",attrs:{offset:"0%","stop-color":"rgba(9, 173, 255, 1)"}}),t._v(" "),a("stop",{staticClass:"stop2",attrs:{offset:"50%","stop-color":"rgba(128, 128, 128, 0.1)"}}),t._v(" "),a("stop",{staticClass:"stop3",attrs:{offset:"100%","stop-color":"rgba(255, 91, 9, 1)"}})],1)],1)])},staticRenderFns:[]}},735:function(t,e){},97:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.WordCloud=void 0;var s=a(33),r=n(s),i=a(25),o=n(i),l=a(26),u=n(l),c=a(21),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(c),d=a(416),f=n(d),p=a(11),g={stroke:"black","stroke-width":1,fill:"white","fill-opacity":0,"stroke-opacity":.2},v={font:"Arial",fontSize:[9,17],fontWeight:[300,400,500],padding:0,opacity:.7,baseColor:"#1f77b4"},m=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rect",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,o.default)(this,t),this.selector=e,this.bggroup=this.selector.append("g"),this.bg=this.bggroup.append("g"),this.bgHandle,this.bgshape=s,this.bgLayout=g,this.wordLayout=v,this.group=this.bggroup.append("g"),this.radius=[a,n],this.data,this.cloud=null,this.font="Impact",this.margin_=0,this.colorScheme=h.scaleOrdinal(h.schemeCategory10),this.word2data,this.compare=r,this.boundingSize=[2*a,2*n]}return(0,u.default)(t,[{key:"size",value:function(t){return this.radius[0]=t[0]/2,this.radius[1]=t[1]/2,this}},{key:"wordLayoutParams",value:function(t){return arguments.length?(this.wordLayout=t,this):this.wordLayout}},{key:"bgLayoutParams",value:function(t){return arguments.length?(this.bgLayout=t,this):this.bgLayout}},{key:"transform",value:function(t){return this.compare&&(t+=" scale(-1, 1)"),this.bggroup.transition().duration(200).attr("transform",t),this}},{key:"background",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.bgLayout.fill=t,this.bgLayout["fill-opacity"]=e,this}},{key:"drawBackground",value:function(){var t=this;return this.bgHandle&&this.bgHandle.remove(),this.bgHandle=this.bg.append(this.bgshape),"rect"===this.bgshape?this.bgHandle.attr("x",-this.radius[0]).attr("y",-this.radius[1]).attr("rx",4).attr("ry",4).attr("width",2*this.radius[0]).attr("height",2*this.radius[1]):"ellipse"===this.bgshape&&this.bgHandle.attr("cx",0).attr("cy",0).attr("rx",radius[0]).attr("ry",radius[1]),(0,r.default)(this.bgLayout).forEach(function(e){t.bgHandle.attr(e,t.bgLayout[e])}),this}},{key:"margin",value:function(t){return this.margin_=t,this}},{key:"fontFamily",value:function(t){return this.wordLayout.font=t,this}},{key:"color",value:function(t){return this.colorScheme=t,this}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[this.width/2,this.height/2],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.data;e[0]===this.width/2&&e[1]===this.height/2||(this.radius=e,this.drawBackground()),this.bgHandle||this.drawBackground(),this.data||(this.data=a);var n=e[0],s=e[1],r=this.wordLayout,i=a.filter(function(t){return-n<t.x-t.width/4&&-s<t.y-t.size/2&&t.x+t.width/4<n&&t.y-t.size/2<s}),o=this;this.cloud=this.group.selectAll("text").data(i,function(t){return t.text});var l=this.cloud.enter().append("text").style("font-family",r.font).attr("text-anchor","middle").style("fill",function(t,e){return"number"==typeof t.type?o.colorScheme(t.type):r.baseColor});return l.text(function(t){return t.text}),this.cloud.style("fill",function(t,e){return"number"==typeof t.type?o.colorScheme(t.type):r.baseColor}),l.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}).attr("font-size",function(t){return t.size+"px"}).attr("font-weight",function(t){return t.weight}).style("fill-opacity",0).transition().duration(300).style("fill-opacity",r.opacity),l.on("mouseover",function(){h.select(this).style("fill-opacity",1)}).on("mouseout",function(t,e){t.select||h.select(this).style("fill-opacity",r.opacity)}).on("click",function(t,e){t.select?(t.select=!1,p.bus.$emit(p.DESELECT_WORD,t,o.compare),h.select(this).style("fill-opacity",r.opacity).style("font-weight",t.weight)):(t.select=!0,t.opacity=r.opacity,t.baseColor="number"==typeof t.type?o.colorScheme(t.type):r.baseColor,h.select(this).style("fill-opacity",1).style("font-weight",t.weight+500),p.bus.$emit(p.SELECT_WORD,t,o.compare))}),l.each(function(t){t.el=this}),this.word2data={},this.data.forEach(function(e){return t.word2data[e.text]=e}),this.cloud.exit().transition().duration(200).style("fill-opacity",1e-6).attr("font-size",1).remove(),this}},{key:"update",value:function(t){var e=this;t.sort(function(t,e){return t.size-e.size});var a=h.extent(t,function(t){return t.size}),n=h.scalePow().range(this.wordLayout.fontSize).domain(a),s=h.scaleQuantize().range(this.wordLayout.fontWeight).domain(a);t.forEach(function(t){t.weight=Math.round(s(t.size)),t.size=n(t.size)}),e.boundingSize=[1.3*e.boundingSize[0],1.05*e.boundingSize[1]],(0,f.default)().size(this.boundingSize).words(t).padding(this.wordLayout.padding).rotate(0).font(this.wordLayout.font).text(function(t){return t.text}).fontSize(function(t){return t.size}).fontWeight(function(t){return t.weight}).on("end",function(t){e.draw([e.width/2,e.height/2],t)}).random(function(){return.5}).spiral("rectangular").start()}},{key:"autoscale",value:function(t){var e=.9*this.width/Math.abs(t[0].x-t[1].x),a=.9*this.height/Math.abs(t[0].y-t[1].y),n=Math.min(e,a),s=(t[1].x+t[0].x-this.width)/2*n,r=(t[1].y+t[0].y-this.height)/2*n;this.group.attr("transform","scale("+n+") translate("+-s+", "+-r+")")}},{key:"destroy",value:function(){this.selector.transition().duration(300).attr("opacity",0).remove()}},{key:"width",get:function(){return 2*(this.radius[0]-this.margin_)}},{key:"height",get:function(){return 2*(this.radius[1]-this.margin_)}},{key:"polygon",get:function(){for(var t=[],e=0;e<4;e++)t.push([Math.round(this.radiusX*Math.cos(2*Math.PI*e/4)),Math.round(this.radiusY*Math.sin(2*Math.PI*e/4))]);return t}}]),t}();e.WordCloud=m,e.default={WordCloud:m}}},[308]);
//# sourceMappingURL=app.d98cff66465a3838eb9f.js.map